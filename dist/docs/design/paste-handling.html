<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Paste Handling (Internal vs External) | Fresh</title>
    <meta name="description" content="Fresh is a fast, modern terminal text editor with intuitive keybindings, syntax highlighting, and instant startup.">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/fresh/assets/style.BRX1cOS8.css" as="style">
    <link rel="preload stylesheet" href="/fresh/vp-icons.css" as="style">
    
    <script type="module" src="/fresh/assets/app.gWnVHcnC.js"></script>
    <link rel="preload" href="/fresh/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/fresh/assets/chunks/theme.7qGkjoxp.js">
    <link rel="modulepreload" href="/fresh/assets/chunks/framework.CffQSbY-.js">
    <link rel="modulepreload" href="/fresh/assets/design_paste-handling.md.BoGHj9tm.lean.js">
    <link rel="icon" href="/fresh/favicon.ico">
    <script id="check-dark-mode">document.documentElement.classList.add("dark");</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/fresh/" data-v-1168a8e4><!--[--><!--]--><!--[--><!--[--><!--[--><img class="VPImage dark logo" src="/fresh/logo.svg" alt data-v-8426fc1a><!--]--><!--[--><img class="VPImage light logo" src="/fresh/logo.svg" alt data-v-8426fc1a><!--]--><!--]--><!--]--><span data-v-1168a8e4>Fresh</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/fresh/guide/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Guide</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/fresh/features/terminal" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Features</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/fresh/development/architecture" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Development</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://github.com/sinelaw/fresh/releases/latest" target="_blank" rel="noreferrer" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Download</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://github.com/sinelaw/fresh/issues" target="_blank" rel="noreferrer" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Issues & Requests</span><!--]--></a><!--]--><!--]--></nav><!----><!----><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/sinelaw/fresh" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><!----><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/sinelaw/fresh" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><!----><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/index" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Getting Started</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>User Guide</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Introduction</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/editing" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Editing & Navigation</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/terminal" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Terminal</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/lsp" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>LSP Integration</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/plugins" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Plugins</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/themes" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Themes</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/configuration" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Configuration</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/keyboard" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Keyboard Setup</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/i18n" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Internationalization</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/troubleshooting" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Troubleshooting</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/keybindings" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Keybindings</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Features</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/features/terminal" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Terminal</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/features/vi-mode" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Vi Mode</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Development</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/development/architecture" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Architecture</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/development/plugin-api" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Plugin API</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/development/plugin-development" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Plugin Development</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed has-active" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Design Documents</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/design/config-editor" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Config Editor</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/design/paste-handling" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Paste Handling</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/design/scroll-sync" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Scroll Sync</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/design/unicode-width" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Unicode Width</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/design/visual-layout" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Visual Layout</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/design/i18n" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Internationalization</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/design/search-next-occurrence" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Search Next Occurrence</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _fresh_design_paste-handling" data-v-39a288b8><div><h1 id="paste-handling-internal-vs-external" tabindex="-1">Paste Handling (Internal vs External) <a class="header-anchor" href="#paste-handling-internal-vs-external" aria-label="Permalink to &quot;Paste Handling (Internal vs External)&quot;">​</a></h1><p>Fresh currently has two distinct “paste” paths:</p><ol><li><p><strong>Internal paste</strong> (editor action <code>Paste</code>, e.g. <code>Ctrl+V</code> or menu <code>Edit -&gt; Paste</code>)</p><ul><li>Fresh can fetch clipboard contents and apply it as a single edit event.</li><li>Result: a single undo step reverses the whole paste.</li></ul></li><li><p><strong>External terminal paste</strong> (often <code>Ctrl+Shift+V</code>)</p><ul><li>Fresh does <strong>not</strong> control this.</li><li>Many terminals send this as a rapid stream of key events (e.g. <code>KeyCode::Char(_)</code>), which currently becomes many independent edit events/undo steps.</li></ul></li></ol><p>Issue: #372 — external paste should behave more like internal paste in undo history.</p><h2 id="goals" tabindex="-1">Goals <a class="header-anchor" href="#goals" aria-label="Permalink to &quot;Goals&quot;">​</a></h2><ul><li>Detect external paste when possible and apply it as <strong>one undoable edit</strong>.</li><li>Avoid character-by-character paste behavior (auto-close, skip-over, auto-indent quirks) when pasting large text.</li><li>Keep normal typing behavior (undo granularity, auto-close, etc.) unchanged.</li><li>Provide a best-effort fallback for terminals that cannot reliably mark paste.</li></ul><h2 id="best-detection-bracketed-paste-reliable" tabindex="-1">Best detection: “bracketed paste” (reliable) <a class="header-anchor" href="#best-detection-bracketed-paste-reliable" aria-label="Permalink to &quot;Best detection: “bracketed paste” (reliable)&quot;">​</a></h2><p>Many terminals support <strong>bracketed paste mode</strong>, where pasted content is wrapped in escape sequences. When the application enables bracketed paste mode, input libraries can surface paste as a single event.</p><p>Fresh already has evidence that <code>crossterm</code> can surface this as <code>Event::Paste(String)</code>:</p><ul><li><code>src/bin/event_debug.rs</code> prints <code>Event::Paste(text)</code></li></ul><h3 id="design" tabindex="-1">Design <a class="header-anchor" href="#design" aria-label="Permalink to &quot;Design&quot;">​</a></h3><ol><li><p><strong>Enable bracketed paste on startup</strong></p><ul><li>When supported, this causes external paste (e.g. <code>Ctrl+Shift+V</code>) to arrive as a distinct “paste” event rather than a stream of keypresses.</li></ul></li><li><p><strong>Handle <code>CrosstermEvent::Paste(text)</code> in the main loop</strong></p><ul><li>The main event loop (<code>src/main.rs</code> <code>run_event_loop_common</code>) currently only handles <code>Key/Mouse/Resize</code> and ignores other <code>CrosstermEvent</code> variants.</li><li>Add handling for paste events and route them to the editor as a single atomic edit.</li></ul></li><li><p><strong>Insert as one undo step</strong></p><ul><li>Insert the entire <code>text</code> with one undoable entry: <ul><li>Single cursor: one <code>Event::Insert { text, ... }</code></li><li>Multi-cursor and/or selection deletion: one <code>Event::Batch { events, description }</code></li></ul></li><li>This reuses existing undo semantics: <code>Event::Batch</code> is undone/redone atomically (<code>src/model/event.rs</code>).</li></ul></li></ol><h3 id="behavioral-notes" tabindex="-1">Behavioral notes <a class="header-anchor" href="#behavioral-notes" aria-label="Permalink to &quot;Behavioral notes&quot;">​</a></h3><ul><li>Paste insertion should avoid character-level auto-edit behaviors (auto-close delimiters, skip-over, etc.) that are desirable for typing but often undesirable for bulk paste.</li><li>Newline/tab handling is naturally correct because the paste event includes the literal text.</li></ul><h2 id="fallback-burst-coalescing-heuristic-best-effort" tabindex="-1">Fallback: burst coalescing heuristic (best-effort) <a class="header-anchor" href="#fallback-burst-coalescing-heuristic-best-effort" aria-label="Permalink to &quot;Fallback: burst coalescing heuristic (best-effort)&quot;">​</a></h2><p>If bracketed paste is unavailable, external paste may still be indistinguishable from “very fast typing” because it arrives as a stream of <code>KeyCode::Char(_)</code> events.</p><p>In this case, the best practical option is a heuristic: coalesce a burst of fast character input into one edit.</p><h3 id="heuristic-proposal" tabindex="-1">Heuristic proposal <a class="header-anchor" href="#heuristic-proposal" aria-label="Permalink to &quot;Heuristic proposal&quot;">​</a></h3><ul><li>Maintain a short-lived buffer of “textual” keypresses in the event loop: <ul><li>Typically <code>KeyCode::Char(c)</code> with no modifiers.</li><li>Optionally include <code>Enter</code> → <code>&#39;\n&#39;</code> and <code>Tab</code> → <code>&#39;\t&#39;</code> if desired.</li></ul></li><li>Treat input as a paste-burst when <strong>both</strong> are true: <ul><li>Inter-key gaps are extremely small (e.g. <code>&lt;= 2–5ms</code>)</li><li>Burst length crosses a minimum (e.g. <code>&gt;= 8–16 chars</code>)</li></ul></li><li>Flush the buffer immediately when: <ul><li>A non-text key arrives (navigation, delete, etc.)</li><li>Any mouse/resize event arrives</li><li>UI context changes (prompt/menu/settings/popup)</li><li>The time gap exceeds the threshold</li></ul></li><li>When flushing: <ul><li>Apply the buffered text via the same “atomic insert” path used by bracketed paste (single undo step).</li></ul></li></ul><h3 id="limitations" tabindex="-1">Limitations <a class="header-anchor" href="#limitations" aria-label="Permalink to &quot;Limitations&quot;">​</a></h3><ul><li>This can never be perfect: extremely fast typists or keyboard macros may be misclassified as paste.</li><li>Bracketed paste remains the preferred, robust solution.</li></ul><h2 id="atomic-insert-api-recommended-internal-abstraction" tabindex="-1">“Atomic insert” API (recommended internal abstraction) <a class="header-anchor" href="#atomic-insert-api-recommended-internal-abstraction" aria-label="Permalink to &quot;“Atomic insert” API (recommended internal abstraction)&quot;">​</a></h2><p>To keep paste behavior consistent across internal paste, bracketed paste, and heuristic coalescing, define a single editor-level entrypoint such as:</p><ul><li><code>insert_text_atomic(text, description, source)</code></li></ul><p>Where <code>source</code> might distinguish:</p><ul><li><code>InternalPaste</code> (clipboard-driven)</li><li><code>ExternalPaste</code> (bracketed paste event)</li><li><code>CoalescedInput</code> (heuristic)</li></ul><p>Responsibilities of the atomic insert path:</p><ul><li>Delete selections (if any) before inserting.</li><li>Insert the entire string as one undoable entry (<code>Event::Insert</code> or <code>Event::Batch</code>).</li><li>Ensure all cross-cutting concerns run through the normal event path: <ul><li>Use <code>Editor::apply_event_to_active_buffer(...)</code> so LSP, plugin hooks, layout invalidation, etc. remain consistent (<code>src/app/mod.rs</code>).</li></ul></li></ul><h2 id="suggested-configuration-knobs" tabindex="-1">Suggested configuration knobs <a class="header-anchor" href="#suggested-configuration-knobs" aria-label="Permalink to &quot;Suggested configuration knobs&quot;">​</a></h2><p>To keep behavior tunable across terminals and preferences:</p><ul><li><code>editor.enable_bracketed_paste</code> (default: true)</li><li><code>editor.external_paste_coalesce</code> (default: true)</li><li><code>editor.external_paste_min_chars</code> (default: 16)</li><li><code>editor.external_paste_max_inter_key_ms</code> (default: 3)</li><li>Optional: <code>editor.external_paste_max_total_ms</code> (cap to avoid pathological grouping)</li></ul><h2 id="implementation-touchpoints-for-372" tabindex="-1">Implementation touchpoints (for #372) <a class="header-anchor" href="#implementation-touchpoints-for-372" aria-label="Permalink to &quot;Implementation touchpoints (for #372)&quot;">​</a></h2><ul><li><code>src/main.rs</code><ul><li>Handle <code>CrosstermEvent::Paste(text)</code> in <code>run_event_loop_common</code>.</li><li>(If needed) enable bracketed paste mode during terminal setup/teardown.</li></ul></li><li><code>src/app/*</code><ul><li>Add an editor API to apply an “atomic insert” (single undo entry) for paste-like input sources.</li></ul></li><li><code>src/model/event.rs</code><ul><li>No new primitives required; <code>Event::Batch</code> already provides atomic undo/redo.</li></ul></li></ul></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><div class="edit-info" data-v-e257564d><div class="edit-link" data-v-e257564d><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/sinelaw/fresh/edit/master/docs/design/paste-handling.md" target="_blank" rel="noreferrer" data-v-e257564d><!--[--><span class="vpi-square-pen edit-link-icon" data-v-e257564d></span> Edit this page<!--]--></a></div><div class="last-updated" data-v-e257564d><p class="VPLastUpdated" data-v-e257564d data-v-e98dd255>Last updated: <time datetime="2026-01-07T03:37:03.000Z" data-v-e98dd255></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/fresh/design/config-editor" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>Config Editor</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/fresh/design/scroll-sync" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>Scroll Sync</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5d98c3a5 data-v-e315a0ad><div class="container" data-v-e315a0ad><p class="message" data-v-e315a0ad>Released under the Apache 2.0 License</p><!----></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"design_config-editor.md\":\"DHGjzCxf\",\"design_i18n.md\":\"XST-buo6\",\"design_paste-handling.md\":\"BoGHj9tm\",\"design_scroll-sync.md\":\"5y7aEty5\",\"design_search-next-occurrence.md\":\"eH349-M3\",\"design_unicode-width.md\":\"DXXzrMtJ\",\"design_visual-layout.md\":\"CR2Yf-UK\",\"development_architecture.md\":\"C0z0erNC\",\"development_plugin-api.md\":\"02Zf_uWD\",\"development_plugin-development.md\":\"DDVOsukg\",\"features_terminal.md\":\"DXQyMBXY\",\"features_vi-mode.md\":\"DxOi2haG\",\"guide_configuration.md\":\"DKSUV7wf\",\"guide_editing.md\":\"qgrD9jGh\",\"guide_i18n.md\":\"BQuZvWbg\",\"guide_index.md\":\"CNsD-Eyr\",\"guide_keybindings.md\":\"lQgq3MNO\",\"guide_keyboard.md\":\"LxmlLjdz\",\"guide_lsp.md\":\"DPCnEwA7\",\"guide_plugins.md\":\"BQZA9F_p\",\"guide_terminal.md\":\"CEp4n3DC\",\"guide_themes.md\":\"CexLbvsP\",\"guide_troubleshooting.md\":\"qMYBY5ed\",\"index.md\":\"4kX30mfe\",\"internal_bulk-edit-optimization.md\":\"BMxCHJDA\",\"internal_config_design.md\":\"Dl6dywEy\",\"internal_config_implementation_plan.md\":\"nGKfbTil\",\"internal_cr.md\":\"CddFPN2F\",\"internal_diff_view.md\":\"C7ID9-Nc\",\"internal_input_calibration_wizard.md\":\"MB1ejh_K\",\"internal_markdown.md\":\"B2IwUkFR\",\"internal_readme.md\":\"DLpZaH-e\",\"internal_theme-usability-improvements.md\":\"C1sTTe52\",\"internal_theme-user-flows.md\":\"DT0SwUX6\",\"internal_timesource_design.md\":\"Cte2Jzc2\",\"internal_warning_notification_ux.md\":\"CG_GzLqf\",\"visual-regression_tests_comprehensive_ui_a.md\":\"D02B_xcU\",\"visual-regression_tests_comprehensive_ui_b.md\":\"q7gT-nbA\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Fresh\",\"description\":\"Fresh is a fast, modern terminal text editor with intuitive keybindings, syntax highlighting, and instant startup.\",\"base\":\"/fresh/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":\"force-dark\",\"themeConfig\":{\"logo\":{\"light\":\"/logo.svg\",\"dark\":\"/logo.svg\"},\"nav\":[{\"text\":\"Guide\",\"link\":\"/guide/\"},{\"text\":\"Features\",\"link\":\"/features/terminal\"},{\"text\":\"Development\",\"link\":\"/development/architecture\"},{\"text\":\"Download\",\"link\":\"https://github.com/sinelaw/fresh/releases/latest\"},{\"text\":\"Issues & Requests\",\"link\":\"https://github.com/sinelaw/fresh/issues\"}],\"sidebar\":[{\"items\":[{\"text\":\"Getting Started\",\"link\":\"/index\"}]},{\"text\":\"User Guide\",\"collapsed\":false,\"items\":[{\"text\":\"Introduction\",\"link\":\"/guide/\"},{\"text\":\"Editing & Navigation\",\"link\":\"/guide/editing\"},{\"text\":\"Terminal\",\"link\":\"/guide/terminal\"},{\"text\":\"LSP Integration\",\"link\":\"/guide/lsp\"},{\"text\":\"Plugins\",\"link\":\"/guide/plugins\"},{\"text\":\"Themes\",\"link\":\"/guide/themes\"},{\"text\":\"Configuration\",\"link\":\"/guide/configuration\"},{\"text\":\"Keyboard Setup\",\"link\":\"/guide/keyboard\"},{\"text\":\"Internationalization\",\"link\":\"/guide/i18n\"},{\"text\":\"Troubleshooting\",\"link\":\"/guide/troubleshooting\"},{\"text\":\"Keybindings\",\"link\":\"/guide/keybindings\"}]},{\"text\":\"Features\",\"collapsed\":false,\"items\":[{\"text\":\"Terminal\",\"link\":\"/features/terminal\"},{\"text\":\"Vi Mode\",\"link\":\"/features/vi-mode\"}]},{\"text\":\"Development\",\"collapsed\":false,\"items\":[{\"text\":\"Architecture\",\"link\":\"/development/architecture\"},{\"text\":\"Plugin API\",\"link\":\"/development/plugin-api\"},{\"text\":\"Plugin Development\",\"link\":\"/development/plugin-development\"}]},{\"text\":\"Design Documents\",\"collapsed\":true,\"items\":[{\"text\":\"Config Editor\",\"link\":\"/design/config-editor\"},{\"text\":\"Paste Handling\",\"link\":\"/design/paste-handling\"},{\"text\":\"Scroll Sync\",\"link\":\"/design/scroll-sync\"},{\"text\":\"Unicode Width\",\"link\":\"/design/unicode-width\"},{\"text\":\"Visual Layout\",\"link\":\"/design/visual-layout\"},{\"text\":\"Internationalization\",\"link\":\"/design/i18n\"},{\"text\":\"Search Next Occurrence\",\"link\":\"/design/search-next-occurrence\"}]}],\"outline\":{\"level\":\"deep\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/sinelaw/fresh\"}],\"search\":{\"provider\":\"local\"},\"editLink\":{\"pattern\":\"https://github.com/sinelaw/fresh/edit/master/docs/:path\"},\"footer\":{\"message\":\"Released under the Apache 2.0 License\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>