import{_ as i,c as a,o as n,ag as t}from"./chunks/framework.CffQSbY-.js";const g=JSON.parse('{"title":"Config Editor Design","description":"","frontmatter":{},"headers":[],"relativePath":"design/config-editor.md","filePath":"design/config-editor.md","lastUpdated":1767757023000}'),e={name:"design/config-editor.md"};function l(p,s,h,r,k,d){return n(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="config-editor-design" tabindex="-1">Config Editor Design <a class="header-anchor" href="#config-editor-design" aria-label="Permalink to &quot;Config Editor Design&quot;">​</a></h1><blockquote><p>Built-in settings editor for Fresh, replacing the plugin-based config_editor.ts</p></blockquote><h2 id="research-summary" tabindex="-1">Research Summary <a class="header-anchor" href="#research-summary" aria-label="Permalink to &quot;Research Summary&quot;">​</a></h2><h3 id="zed-editor-settings-ui" tabindex="-1">Zed Editor Settings UI <a class="header-anchor" href="#zed-editor-settings-ui" aria-label="Permalink to &quot;Zed Editor Settings UI&quot;">​</a></h3><ul><li><strong>Layout</strong>: Separate window with categories on left, controls on right</li><li><strong>Philosophy</strong>: &quot;Files as the organizing principle&quot; - settings.json always available for power users</li><li><strong>Controls</strong>: Form-based structure with strongly-typed settings</li><li><strong>Navigation</strong>: Tab groups for keyboard navigability, focus management</li><li><strong>State</strong>: Direct UI tree state (similar to React hooks)</li><li><strong>Source</strong>: <a href="https://zed.dev/blog/settings-ui" target="_blank" rel="noreferrer">How We Rebuilt Settings in Zed</a></li></ul><h3 id="intellij-idea-settings" tabindex="-1">IntelliJ IDEA Settings <a class="header-anchor" href="#intellij-idea-settings" aria-label="Permalink to &quot;IntelliJ IDEA Settings&quot;">​</a></h3><ul><li><strong>Layout</strong>: Hierarchical tree navigation on left, settings panel on right</li><li><strong>Search</strong>: Prominent search field at top-left for filtering settings</li><li><strong>Indicators</strong>: Icon marks project-specific vs IDE-wide settings</li><li><strong>Actions</strong>: OK (apply + close), Apply (apply + stay open), Cancel</li><li><strong>Theme</strong>: New &quot;Islands&quot; theme (2025) with rounded corners, balanced spacing</li><li><strong>Source</strong>: <a href="https://www.jetbrains.com/help/idea/settings-preferences-dialog.html" target="_blank" rel="noreferrer">IntelliJ Settings Documentation</a></li></ul><h3 id="vs-code-settings" tabindex="-1">VS Code Settings <a class="header-anchor" href="#vs-code-settings" aria-label="Permalink to &quot;VS Code Settings&quot;">​</a></h3><ul><li><strong>Indicators</strong>: Colored bar on left shows modified settings (like editor gutter)</li><li><strong>Search</strong>: Powerful Bing-powered search with extension discovery</li><li><strong>Controls</strong>: Type-aware inputs (checkboxes for bools, dropdowns for enums)</li><li><strong>Context Menu</strong>: Gear icon for reset to default, copy setting ID</li><li><strong>Validation</strong>: Inline validation errors</li><li><strong>Source</strong>: <a href="https://dev.to/vscode/all-new-vscode-settings-editor-ui-----3j48" target="_blank" rel="noreferrer">VS Code Settings Editor UI</a></li></ul><hr><h2 id="design-goals" tabindex="-1">Design Goals <a class="header-anchor" href="#design-goals" aria-label="Permalink to &quot;Design Goals&quot;">​</a></h2><ol><li><strong>Terminal-Native</strong>: Designed for TUI, not a web GUI port</li><li><strong>Keyboard-First</strong>: Full navigation without mouse</li><li><strong>Discoverable</strong>: Users can browse and find settings without reading docs</li><li><strong>Efficient</strong>: Common settings are quick to change</li><li><strong>Safe</strong>: Changes can be previewed and reverted</li><li><strong>JSON Accessible</strong>: Power users can still edit config.json directly</li></ol><hr><h2 id="ui-layout" tabindex="-1">UI Layout <a class="header-anchor" href="#ui-layout" aria-label="Permalink to &quot;UI Layout&quot;">​</a></h2><p>The config editor opens as a full-screen modal (like the file picker), not a separate buffer.</p><h3 id="main-screen-structure" tabindex="-1">Main Screen Structure <a class="header-anchor" href="#main-screen-structure" aria-label="Permalink to &quot;Main Screen Structure&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─ Settings ─────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│ [/] Search settings...                              [?] Help  [Esc] Close  │</span></span>
<span class="line"><span>├────────────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│ ▸ Editor                     │ ╔══════════════════════════════════════════╗│</span></span>
<span class="line"><span>│   Appearance                 │ ║ Line Numbers                      [✓]  ●║│</span></span>
<span class="line"><span>│   Behavior                   │ ║ Show line numbers in the gutter         ║│</span></span>
<span class="line"><span>│   Performance                │ ╠══════════════════════════════════════════╣│</span></span>
<span class="line"><span>│ ▸ File Explorer              │ ║ Relative Line Numbers             [ ]   ║│</span></span>
<span class="line"><span>│ ▸ Terminal                   │ ║ Show line numbers relative to cursor    ║│</span></span>
<span class="line"><span>│ ▸ LSP / Language Servers     │ ╠══════════════════════════════════════════╣│</span></span>
<span class="line"><span>│ ▸ Languages                  │ ║ Tab Size                         [4  ]  ║│</span></span>
<span class="line"><span>│ ▸ Keybindings                │ ║ Number of spaces per tab character      ║│</span></span>
<span class="line"><span>│ ▸ Theme                      │ ╠══════════════════════════════════════════╣│</span></span>
<span class="line"><span>│ ▸ Updates                    │ ║ Line Wrap                         [✓]   ║│</span></span>
<span class="line"><span>│                              │ ║ Wrap long lines to fit window width     ║│</span></span>
<span class="line"><span>│                              │ ╠══════════════════════════════════════════╣│</span></span>
<span class="line"><span>│                              │ ║ Scroll Offset                    [3  ]  ║│</span></span>
<span class="line"><span>│                              │ ║ Minimum lines above/below cursor        ║│</span></span>
<span class="line"><span>│                              │ ╚══════════════════════════════════════════╝│</span></span>
<span class="line"><span>├────────────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│ Tab:Edit  ↑↓:Navigate  Enter:Toggle/Expand  /:Search  Ctrl+S:Save  Esc:Exit│</span></span>
<span class="line"><span>└────────────────────────────────────────────────────────────────────────────┘</span></span></code></pre></div><p>Key elements:</p><ul><li><strong>Left Panel</strong>: Category tree (collapsible sections)</li><li><strong>Right Panel</strong>: Settings for selected category</li><li><strong>Status Bar</strong>: Keyboard shortcuts cheat sheet</li><li><strong>Modified Indicator</strong>: Dot (●) next to changed settings</li></ul><hr><h2 id="category-organization" tabindex="-1">Category Organization <a class="header-anchor" href="#category-organization" aria-label="Permalink to &quot;Category Organization&quot;">​</a></h2><h3 id="hierarchy" tabindex="-1">Hierarchy <a class="header-anchor" href="#hierarchy" aria-label="Permalink to &quot;Hierarchy&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>├── Editor</span></span>
<span class="line"><span>│   ├── Appearance</span></span>
<span class="line"><span>│   │   ├── Line Numbers</span></span>
<span class="line"><span>│   │   ├── Relative Line Numbers</span></span>
<span class="line"><span>│   │   └── Syntax Highlighting</span></span>
<span class="line"><span>│   ├── Behavior</span></span>
<span class="line"><span>│   │   ├── Tab Size</span></span>
<span class="line"><span>│   │   ├── Auto Indent</span></span>
<span class="line"><span>│   │   └── Line Wrap</span></span>
<span class="line"><span>│   ├── Mouse</span></span>
<span class="line"><span>│   │   ├── Mouse Hover Enabled</span></span>
<span class="line"><span>│   │   ├── Mouse Hover Delay</span></span>
<span class="line"><span>│   │   └── Double Click Time</span></span>
<span class="line"><span>│   └── Performance</span></span>
<span class="line"><span>│       ├── Highlight Timeout</span></span>
<span class="line"><span>│       ├── Large File Threshold</span></span>
<span class="line"><span>│       └── Highlight Context Bytes</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── File Explorer</span></span>
<span class="line"><span>│   ├── Show Hidden Files</span></span>
<span class="line"><span>│   ├── Show Gitignored Files</span></span>
<span class="line"><span>│   ├── Respect Gitignore</span></span>
<span class="line"><span>│   ├── Width</span></span>
<span class="line"><span>│   └── Custom Ignore Patterns</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── Terminal</span></span>
<span class="line"><span>│   └── Jump to End on Output</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── LSP / Language Servers</span></span>
<span class="line"><span>│   ├── [rust]</span></span>
<span class="line"><span>│   │   ├── Command</span></span>
<span class="line"><span>│   │   ├── Args</span></span>
<span class="line"><span>│   │   ├── Enabled</span></span>
<span class="line"><span>│   │   └── Auto Start</span></span>
<span class="line"><span>│   ├── [python]</span></span>
<span class="line"><span>│   │   └── ...</span></span>
<span class="line"><span>│   └── [Add Server...]</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── Languages</span></span>
<span class="line"><span>│   ├── [rust]</span></span>
<span class="line"><span>│   │   ├── Extensions</span></span>
<span class="line"><span>│   │   ├── Grammar</span></span>
<span class="line"><span>│   │   ├── Comment Prefix</span></span>
<span class="line"><span>│   │   ├── Highlighter</span></span>
<span class="line"><span>│   │   └── TextMate Grammar</span></span>
<span class="line"><span>│   └── [Add Language...]</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── Keybindings</span></span>
<span class="line"><span>│   ├── Active Map (dropdown: default/emacs/vscode)</span></span>
<span class="line"><span>│   ├── [View Current Bindings...]</span></span>
<span class="line"><span>│   └── [Edit keybindings JSON...]</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── Theme</span></span>
<span class="line"><span>│   └── Theme Name (dropdown with preview)</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── Recovery</span></span>
<span class="line"><span>│   ├── Recovery Enabled</span></span>
<span class="line"><span>│   └── Auto Save Interval</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>└── Updates</span></span>
<span class="line"><span>    └── Check for Updates</span></span></code></pre></div><hr><h2 id="control-types" tabindex="-1">Control Types <a class="header-anchor" href="#control-types" aria-label="Permalink to &quot;Control Types&quot;">​</a></h2><h3 id="boolean-toggle" tabindex="-1">Boolean Toggle <a class="header-anchor" href="#boolean-toggle" aria-label="Permalink to &quot;Boolean Toggle&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌──────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│ Line Numbers                                          [✓]  ●│</span></span>
<span class="line"><span>│ Show line numbers in the gutter                              │</span></span>
<span class="line"><span>│                                                              │</span></span>
<span class="line"><span>│ Default: On                                                  │</span></span>
<span class="line"><span>└──────────────────────────────────────────────────────────────┘</span></span></code></pre></div><ul><li><code>[✓]</code> = enabled, <code>[ ]</code> = disabled</li><li>Press <code>Space</code> or <code>Enter</code> to toggle</li><li><code>●</code> indicates modified from default</li></ul><h3 id="number-input" tabindex="-1">Number Input <a class="header-anchor" href="#number-input" aria-label="Permalink to &quot;Number Input&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌──────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│ Tab Size                                             [4   ] │</span></span>
<span class="line"><span>│ Number of spaces per tab character                           │</span></span>
<span class="line"><span>│                                                              │</span></span>
<span class="line"><span>│ Default: 4  |  Valid range: 1-16                             │</span></span>
<span class="line"><span>└──────────────────────────────────────────────────────────────┘</span></span></code></pre></div><ul><li>Shows current value in editable field</li><li>Press <code>Enter</code> to edit, type number, <code>Enter</code> to confirm</li><li>Validation shown inline</li></ul><h3 id="dropdown-enum" tabindex="-1">Dropdown / Enum <a class="header-anchor" href="#dropdown-enum" aria-label="Permalink to &quot;Dropdown / Enum&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌──────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│ Active Keybinding Map                         [▼ default  ] │</span></span>
<span class="line"><span>│ Choose your preferred keybinding style                       │</span></span>
<span class="line"><span>│ ┌─────────────────────────────────────┐                      │</span></span>
<span class="line"><span>│ │ ● default                           │                      │</span></span>
<span class="line"><span>│ │   emacs                             │                      │</span></span>
<span class="line"><span>│ │   vscode                            │                      │</span></span>
<span class="line"><span>│ │   custom-vim (user defined)         │                      │</span></span>
<span class="line"><span>│ └─────────────────────────────────────┘                      │</span></span>
<span class="line"><span>└──────────────────────────────────────────────────────────────┘</span></span></code></pre></div><ul><li>Press <code>Enter</code> to open dropdown</li><li>Arrow keys to navigate, <code>Enter</code> to select</li><li>Shows current selection in button</li></ul><h3 id="theme-selector-with-preview" tabindex="-1">Theme Selector (with Preview) <a class="header-anchor" href="#theme-selector-with-preview" aria-label="Permalink to &quot;Theme Selector (with Preview)&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌──────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│ Theme                                    [▼ high-contrast  ] │</span></span>
<span class="line"><span>│ Color theme for the editor                                   │</span></span>
<span class="line"><span>│ ┌─────────────────────────────────────┐ ┌──────────────────┐ │</span></span>
<span class="line"><span>│ │ ● high-contrast                     │ │ ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄ │ │</span></span>
<span class="line"><span>│ │   monokai                           │ │ █ fn main() {   █ │ │</span></span>
<span class="line"><span>│ │   solarized-dark                    │ │ █   println!(); █ │ │</span></span>
<span class="line"><span>│ │   solarized-light                   │ │ █ }             █ │ │</span></span>
<span class="line"><span>│ │   dracula                           │ │ ▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀ │ │</span></span>
<span class="line"><span>│ └─────────────────────────────────────┘ └──────────────────┘ │</span></span>
<span class="line"><span>└──────────────────────────────────────────────────────────────┘</span></span></code></pre></div><ul><li>Live preview of theme colors in mini code sample</li><li>Preview updates as you navigate options</li></ul><h3 id="string-input" tabindex="-1">String Input <a class="header-anchor" href="#string-input" aria-label="Permalink to &quot;String Input&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌──────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│ Custom Ignore Patterns                                       │</span></span>
<span class="line"><span>│ Patterns to ignore in file explorer (in addition to gitignore)</span></span>
<span class="line"><span>│ ┌──────────────────────────────────────────────────────────┐ │</span></span>
<span class="line"><span>│ │ *.log                                                    │ │</span></span>
<span class="line"><span>│ │ node_modules/                                            │ │</span></span>
<span class="line"><span>│ │ target/                                                  │ │</span></span>
<span class="line"><span>│ │ [+ Add pattern...]                                       │ │</span></span>
<span class="line"><span>│ └──────────────────────────────────────────────────────────┘ │</span></span>
<span class="line"><span>└──────────────────────────────────────────────────────────────┘</span></span></code></pre></div><ul><li>List of strings with add/remove capability</li><li>Press <code>Enter</code> on item to edit, <code>Delete</code> to remove</li></ul><h3 id="lsp-server-configuration" tabindex="-1">LSP Server Configuration <a class="header-anchor" href="#lsp-server-configuration" aria-label="Permalink to &quot;LSP Server Configuration&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌──────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│ ▾ rust                                              [Default]│</span></span>
<span class="line"><span>├──────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│ Command        [rust-analyzer                              ] │</span></span>
<span class="line"><span>│ Args           [--log-file, /tmp/ra.log                    ] │</span></span>
<span class="line"><span>│ Enabled        [✓]                                           │</span></span>
<span class="line"><span>│ Auto Start     [ ]                                           │</span></span>
<span class="line"><span>│                                                              │</span></span>
<span class="line"><span>│ [Test Connection]  [Reset to Default]                        │</span></span>
<span class="line"><span>└──────────────────────────────────────────────────────────────┘</span></span></code></pre></div><ul><li>Collapsible sections for each language</li><li>&quot;Default&quot; badge when using built-in config</li><li>Test button to verify LSP server is reachable</li></ul><hr><h2 id="search-interface" tabindex="-1">Search Interface <a class="header-anchor" href="#search-interface" aria-label="Permalink to &quot;Search Interface&quot;">​</a></h2><p>When user presses <code>/</code> to search:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─ Settings ─────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│ [/] line numb█                                      [?] Help  [Esc] Close  │</span></span>
<span class="line"><span>├────────────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│                              │ Search Results (2 matches)                  │</span></span>
<span class="line"><span>│ ▸ Editor                     │ ╔══════════════════════════════════════════╗│</span></span>
<span class="line"><span>│   Appearance ←────────────── │ ║ Line Numbers                      [✓]  ●║│</span></span>
<span class="line"><span>│   Behavior                   │ ║ Editor &gt; Appearance                      ║│</span></span>
<span class="line"><span>│   Performance                │ ║ Show line numbers in the gutter         ║│</span></span>
<span class="line"><span>│ ▸ File Explorer              │ ╠══════════════════════════════════════════╣│</span></span>
<span class="line"><span>│ ▸ Terminal                   │ ║ Relative Line Numbers             [ ]   ║│</span></span>
<span class="line"><span>│ ...                          │ ║ Editor &gt; Appearance                      ║│</span></span>
<span class="line"><span>│                              │ ║ Show line numbers relative to cursor    ║│</span></span>
<span class="line"><span>│                              │ ╚══════════════════════════════════════════╝│</span></span>
<span class="line"><span>│                              │                                             │</span></span>
<span class="line"><span>│                              │ [↑↓ Navigate results]  [Enter: Jump to]    │</span></span>
<span class="line"><span>├────────────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│ Esc:Clear search  Enter:Go to result  Tab:Next result                      │</span></span>
<span class="line"><span>└────────────────────────────────────────────────────────────────────────────┘</span></span></code></pre></div><p>Features:</p><ul><li>Fuzzy matching on setting names and descriptions</li><li>Results show breadcrumb path (Editor &gt; Appearance)</li><li>Left panel highlights matching categories</li><li>Press <code>Enter</code> to jump to setting</li><li><code>Esc</code> clears search and returns to browse mode</li></ul><hr><h2 id="modified-settings-tracking" tabindex="-1">Modified Settings Tracking <a class="header-anchor" href="#modified-settings-tracking" aria-label="Permalink to &quot;Modified Settings Tracking&quot;">​</a></h2><p>Visual indicators for changes:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌──────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│ Line Numbers                                          [✓]  ●│  ← Modified</span></span>
<span class="line"><span>│ Relative Line Numbers                                 [ ]   │  ← Default</span></span>
<span class="line"><span>│ Tab Size                                             [2   ]●│  ← Modified</span></span>
<span class="line"><span>└──────────────────────────────────────────────────────────────┘</span></span></code></pre></div><p>The header shows pending changes:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─ Settings ──────────────────────────────────────────── 3 unsaved changes ──┐</span></span></code></pre></div><hr><h2 id="actions-bar" tabindex="-1">Actions Bar <a class="header-anchor" href="#actions-bar" aria-label="Permalink to &quot;Actions Bar&quot;">​</a></h2><p>At the bottom of the settings panel, contextual actions:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌──────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                                                              │</span></span>
<span class="line"><span>│  [Reset to Default]     [Revert All Changes]     [Save]      │</span></span>
<span class="line"><span>│                                                              │</span></span>
<span class="line"><span>└──────────────────────────────────────────────────────────────┘</span></span></code></pre></div><ul><li><strong>Reset</strong>: Reset current setting to default</li><li><strong>Save</strong>: Save changes and close dialog</li><li><strong>Cancel</strong>: Discard changes and close dialog (shows confirmation if unsaved changes exist)</li></ul><hr><h2 id="keyboard-navigation" tabindex="-1">Keyboard Navigation <a class="header-anchor" href="#keyboard-navigation" aria-label="Permalink to &quot;Keyboard Navigation&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Key</th><th>Action</th></tr></thead><tbody><tr><td><code>↑</code> <code>↓</code></td><td>Navigate settings list</td></tr><tr><td><code>←</code> <code>→</code></td><td>Switch between category tree and settings panel (or increment/decrement values)</td></tr><tr><td><code>Enter</code></td><td>Toggle bool, open dropdown, edit value, or activate footer button</td></tr><tr><td><code>Space</code></td><td>Toggle boolean (alternative)</td></tr><tr><td><code>Tab</code></td><td>Cycle between panels: categories → settings → footer buttons</td></tr><tr><td><code>Shift+Tab</code></td><td>Cycle panels in reverse</td></tr><tr><td><code>/</code></td><td>Focus search field</td></tr><tr><td><code>Esc</code></td><td>Clear search / close dropdown / exit settings</td></tr><tr><td><code>?</code></td><td>Show help overlay</td></tr></tbody></table><h3 id="category-tree-navigation" tabindex="-1">Category Tree Navigation <a class="header-anchor" href="#category-tree-navigation" aria-label="Permalink to &quot;Category Tree Navigation&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Key</th><th>Action</th></tr></thead><tbody><tr><td><code>Enter</code></td><td>Expand/collapse section</td></tr><tr><td><code>→</code></td><td>Expand and enter section</td></tr><tr><td><code>←</code></td><td>Collapse or go to parent</td></tr></tbody></table><hr><h2 id="edit-mode-for-complex-values" tabindex="-1">Edit Mode for Complex Values <a class="header-anchor" href="#edit-mode-for-complex-values" aria-label="Permalink to &quot;Edit Mode for Complex Values&quot;">​</a></h2><p>For arrays and objects (like keybindings), switch to a JSON editor:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─ Editing: keybindings ─────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                                                                            │</span></span>
<span class="line"><span>│   1│ [                                                                     │</span></span>
<span class="line"><span>│   2│   {                                                                   │</span></span>
<span class="line"><span>│   3│     &quot;key&quot;: &quot;s&quot;,                                                       │</span></span>
<span class="line"><span>│   4│     &quot;modifiers&quot;: [&quot;ctrl&quot;],                                            │</span></span>
<span class="line"><span>│   5│     &quot;action&quot;: &quot;save&quot;                                                  │</span></span>
<span class="line"><span>│   6│   },                                                                  │</span></span>
<span class="line"><span>│   7│   {                                                                   │</span></span>
<span class="line"><span>│   8│     &quot;key&quot;: &quot;q&quot;,                                                       │</span></span>
<span class="line"><span>│   9│     &quot;modifiers&quot;: [&quot;ctrl&quot;],                                            │</span></span>
<span class="line"><span>│  10│     &quot;action&quot;: &quot;quit&quot;                                                  │</span></span>
<span class="line"><span>│  11│   }                                                                   │</span></span>
<span class="line"><span>│  12│ ]                                                                     │</span></span>
<span class="line"><span>│                                                                            │</span></span>
<span class="line"><span>├────────────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│ Ctrl+Enter:Save and close  Esc:Cancel  (JSON syntax highlighted)          │</span></span>
<span class="line"><span>└────────────────────────────────────────────────────────────────────────────┘</span></span></code></pre></div><ul><li>Full JSON editor with syntax highlighting</li><li>Validation before save</li><li>Schema tooltips on hover (if mouse enabled)</li></ul><hr><h2 id="help-overlay" tabindex="-1">Help Overlay <a class="header-anchor" href="#help-overlay" aria-label="Permalink to &quot;Help Overlay&quot;">​</a></h2><p>Press <code>?</code> to show help:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─ Settings Help ────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                                                                            │</span></span>
<span class="line"><span>│  NAVIGATION                      EDITING                                   │</span></span>
<span class="line"><span>│  ──────────                      ───────                                   │</span></span>
<span class="line"><span>│  ↑/↓    Navigate settings        Enter   Toggle/edit value                 │</span></span>
<span class="line"><span>│  ←/→    Switch panels            Space   Toggle checkbox                   │</span></span>
<span class="line"><span>│  Tab    Next field               Backsp  Clear field                       │</span></span>
<span class="line"><span>│  /      Search settings          Ctrl+Z  Undo change                       │</span></span>
<span class="line"><span>│                                                                            │</span></span>
<span class="line"><span>│  ACTIONS                         FILES                                     │</span></span>
<span class="line"><span>│  ───────                         ─────                                     │</span></span>
<span class="line"><span>│  Ctrl+S Save changes             Config: ~/.config/fresh/config.json       │</span></span>
<span class="line"><span>│  Esc    Close / Cancel                                                     │</span></span>
<span class="line"><span>│  ?      Toggle this help                                                   │</span></span>
<span class="line"><span>│                                                                            │</span></span>
<span class="line"><span>│  Settings are saved to config.json. The JSON file can be edited directly   │</span></span>
<span class="line"><span>│  for advanced configuration. Some settings require restart to take effect. │</span></span>
<span class="line"><span>│                                                                            │</span></span>
<span class="line"><span>│                                              [Press any key to close]      │</span></span>
<span class="line"><span>└────────────────────────────────────────────────────────────────────────────┘</span></span></code></pre></div><hr><h2 id="confirmation-dialogs" tabindex="-1">Confirmation Dialogs <a class="header-anchor" href="#confirmation-dialogs" aria-label="Permalink to &quot;Confirmation Dialogs&quot;">​</a></h2><h3 id="unsaved-changes-on-exit" tabindex="-1">Unsaved Changes on Exit <a class="header-anchor" href="#unsaved-changes-on-exit" aria-label="Permalink to &quot;Unsaved Changes on Exit&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─ Unsaved Changes ───────────────────────────────────────────┐</span></span>
<span class="line"><span>│                                                             │</span></span>
<span class="line"><span>│  You have 3 unsaved changes:                                │</span></span>
<span class="line"><span>│                                                             │</span></span>
<span class="line"><span>│    • editor.tab_size: 4 → 2                                 │</span></span>
<span class="line"><span>│    • editor.line_numbers: true → false                      │</span></span>
<span class="line"><span>│    • theme: &quot;high-contrast&quot; → &quot;monokai&quot;                     │</span></span>
<span class="line"><span>│                                                             │</span></span>
<span class="line"><span>│  ┌─────────────────────────────────────────────────────┐    │</span></span>
<span class="line"><span>│  │   [Save and Exit]    [Discard]    [Cancel]          │    │</span></span>
<span class="line"><span>│  └─────────────────────────────────────────────────────┘    │</span></span>
<span class="line"><span>│                                                             │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────┘</span></span></code></pre></div><h3 id="reset-confirmation" tabindex="-1">Reset Confirmation <a class="header-anchor" href="#reset-confirmation" aria-label="Permalink to &quot;Reset Confirmation&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─ Reset to Default ──────────────────────────────────────────┐</span></span>
<span class="line"><span>│                                                             │</span></span>
<span class="line"><span>│  Reset &quot;tab_size&quot; to its default value?                     │</span></span>
<span class="line"><span>│                                                             │</span></span>
<span class="line"><span>│  Current: 2                                                 │</span></span>
<span class="line"><span>│  Default: 4                                                 │</span></span>
<span class="line"><span>│                                                             │</span></span>
<span class="line"><span>│  ┌─────────────────────────────────────────────────────┐    │</span></span>
<span class="line"><span>│  │        [Reset]              [Cancel]                │    │</span></span>
<span class="line"><span>│  └─────────────────────────────────────────────────────┘    │</span></span>
<span class="line"><span>│                                                             │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────┘</span></span></code></pre></div><hr><h2 id="lsp-server-management" tabindex="-1">LSP Server Management <a class="header-anchor" href="#lsp-server-management" aria-label="Permalink to &quot;LSP Server Management&quot;">​</a></h2><p>Special UI for adding/configuring LSP servers:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─ Add Language Server ───────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                                                                             │</span></span>
<span class="line"><span>│  Language:  [go                                                           ] │</span></span>
<span class="line"><span>│                                                                             │</span></span>
<span class="line"><span>│  Command:   [gopls                                                        ] │</span></span>
<span class="line"><span>│  Arguments: [                                                             ] │</span></span>
<span class="line"><span>│                                                                             │</span></span>
<span class="line"><span>│  ┌─ Common Servers ─────────────────────────────────────────────────────┐   │</span></span>
<span class="line"><span>│  │ rust       → rust-analyzer                                           │   │</span></span>
<span class="line"><span>│  │ python     → pylsp                                                   │   │</span></span>
<span class="line"><span>│  │ typescript → typescript-language-server --stdio                      │   │</span></span>
<span class="line"><span>│  │ go         → gopls                                                   │   │</span></span>
<span class="line"><span>│  │ c/cpp      → clangd                                                  │   │</span></span>
<span class="line"><span>│  └──────────────────────────────────────────────────────────────────────┘   │</span></span>
<span class="line"><span>│                                                                             │</span></span>
<span class="line"><span>│  ┌─────────────────────────────────────────────────────────────────────┐    │</span></span>
<span class="line"><span>│  │        [Add Server]              [Cancel]                           │    │</span></span>
<span class="line"><span>│  └─────────────────────────────────────────────────────────────────────┘    │</span></span>
<span class="line"><span>│                                                                             │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────────────────────┘</span></span></code></pre></div><hr><h2 id="responsive-layout" tabindex="-1">Responsive Layout <a class="header-anchor" href="#responsive-layout" aria-label="Permalink to &quot;Responsive Layout&quot;">​</a></h2><p>For narrow terminals (&lt; 80 columns), use stacked layout:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─ Settings ─────────────────────────────────────────┐</span></span>
<span class="line"><span>│ [/] Search...                           [?] [Esc] │</span></span>
<span class="line"><span>├────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│ ◀ Editor &gt; Appearance                              │</span></span>
<span class="line"><span>├────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│ Line Numbers                              [✓]    ● │</span></span>
<span class="line"><span>│ Show line numbers in the gutter                    │</span></span>
<span class="line"><span>├────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│ Relative Line Numbers                     [ ]      │</span></span>
<span class="line"><span>│ Show relative line numbers                         │</span></span>
<span class="line"><span>├────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│ Tab Size                                  [4   ]   │</span></span>
<span class="line"><span>│ Spaces per tab                                     │</span></span>
<span class="line"><span>├────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│ ↑↓:Nav  Enter:Edit  ◀:Back  Ctrl+S:Save           │</span></span>
<span class="line"><span>└────────────────────────────────────────────────────┘</span></span></code></pre></div><ul><li>Category shown as breadcrumb at top</li><li><code>←</code> / <code>Backspace</code> returns to category list</li><li>Full-width settings panel</li></ul><hr><h2 id="architectural-integration" tabindex="-1">Architectural Integration <a class="header-anchor" href="#architectural-integration" aria-label="Permalink to &quot;Architectural Integration&quot;">​</a></h2><h3 id="current-fresh-rendering-patterns" tabindex="-1">Current Fresh Rendering Patterns <a class="header-anchor" href="#current-fresh-rendering-patterns" aria-label="Permalink to &quot;Current Fresh Rendering Patterns&quot;">​</a></h3><p>Fresh uses a consistent architecture across all UI components:</p><ol><li><strong>Renderer Pattern</strong>: Static structs with <code>render()</code> methods (e.g., <code>FileBrowserRenderer</code>, <code>MenuRenderer</code>, <code>SplitRenderer</code>)</li><li><strong>State Separation</strong>: State structs are separate from renderer structs (e.g., <code>FileOpenState</code> vs <code>FileBrowserRenderer</code>)</li><li><strong>Layout Structs</strong>: Renderers return layout info for mouse hit testing (e.g., <code>FileBrowserLayout</code>)</li><li><strong>Direct Ratatui Usage</strong>: No custom Widget trait - renders directly with ratatui primitives</li><li><strong>Input Context Routing</strong>: <code>KeyContext</code> enum determines which component handles input</li></ol><h3 id="existing-reusable-components" tabindex="-1">Existing Reusable Components <a class="header-anchor" href="#existing-reusable-components" aria-label="Permalink to &quot;Existing Reusable Components&quot;">​</a></h3><p>Fresh already has these reusable building blocks:</p><table tabindex="0"><thead><tr><th>Component</th><th>Location</th><th>Purpose</th></tr></thead><tbody><tr><td><code>ScrollbarState</code> / <code>render_scrollbar()</code></td><td><code>view/ui/scrollbar.rs</code></td><td>Scrollbar with state calculation and hit testing</td></tr><tr><td><code>PopupManager</code> / <code>Popup</code></td><td><code>view/popup.rs</code></td><td>Stack-based popup system with positioning</td></tr><tr><td><code>PopupListItem</code></td><td><code>view/popup.rs</code></td><td>List items with icon, text, detail</td></tr><tr><td><code>parse_markdown()</code></td><td><code>view/popup.rs</code></td><td>Markdown → styled lines for terminal</td></tr></tbody></table><h3 id="integration-strategy" tabindex="-1">Integration Strategy <a class="header-anchor" href="#integration-strategy" aria-label="Permalink to &quot;Integration Strategy&quot;">​</a></h3><p>The settings editor will follow Fresh&#39;s established patterns while introducing reusable form controls.</p><h4 id="module-structure" tabindex="-1">Module Structure <a class="header-anchor" href="#module-structure" aria-label="Permalink to &quot;Module Structure&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>src/</span></span>
<span class="line"><span>├── bin/</span></span>
<span class="line"><span>│   └── generate_schema.rs  # Schema generation binary (uses schemars)</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>└── view/</span></span>
<span class="line"><span>    ├── settings/</span></span>
<span class="line"><span>    │   ├── mod.rs          # Public exports, SettingsView coordinator</span></span>
<span class="line"><span>    │   ├── schema.rs       # Load and parse JSON Schema, build SettingsTree</span></span>
<span class="line"><span>    │   ├── state.rs        # SettingsState, focus, change tracking</span></span>
<span class="line"><span>    │   ├── render.rs       # SettingsRenderer (static render method)</span></span>
<span class="line"><span>    │   ├── layout.rs       # SettingsLayout for hit testing</span></span>
<span class="line"><span>    │   └── search.rs       # Fuzzy search over settings (titles + descriptions)</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    └── controls/           # NEW: Reusable form controls</span></span>
<span class="line"><span>        ├── mod.rs          # Control enum and common traits</span></span>
<span class="line"><span>        ├── toggle.rs       # Boolean checkbox control</span></span>
<span class="line"><span>        ├── number_input.rs # Numeric input with validation</span></span>
<span class="line"><span>        ├── dropdown.rs     # Enum/list selector</span></span>
<span class="line"><span>        ├── text_input.rs   # Single-line text field</span></span>
<span class="line"><span>        ├── text_list.rs    # List of strings (add/remove)</span></span>
<span class="line"><span>        └── button.rs       # Clickable button</span></span></code></pre></div><h4 id="new-keycontext" tabindex="-1">New KeyContext <a class="header-anchor" href="#new-keycontext" aria-label="Permalink to &quot;New KeyContext&quot;">​</a></h4><p>Add <code>KeyContext::Settings</code> to the input routing system, with priority between <code>Prompt</code> and <code>Normal</code>.</p><h4 id="control-abstraction" tabindex="-1">Control Abstraction <a class="header-anchor" href="#control-abstraction" aria-label="Permalink to &quot;Control Abstraction&quot;">​</a></h4><p>The <code>controls/</code> module provides reusable form primitives following the scrollbar pattern:</p><p><strong>ControlState structs</strong> - Hold mutable state for each control type:</p><ul><li><code>ToggleState</code>: value, focused</li><li><code>NumberInputState</code>: value, editing, cursor_pos, validation_error</li><li><code>DropdownState</code>: selected_index, options, expanded, scroll_offset</li><li><code>TextInputState</code>: value, cursor_pos, selection</li><li><code>TextListState</code>: items, selected_index, editing_index</li><li><code>ButtonState</code>: focused, pressed</li></ul><p><strong>Render functions</strong> - Static functions that render controls:</p><ul><li>Take <code>frame</code>, <code>area</code>, <code>state</code>, <code>theme</code> parameters</li><li>Return layout info for hit testing</li><li>Follow the <code>render_scrollbar()</code> pattern</li></ul><p><strong>ControlLayout structs</strong> - Enable mouse interaction:</p><ul><li>Hit testing regions</li><li>Click-to-action mapping</li></ul><h4 id="reuse-opportunities" tabindex="-1">Reuse Opportunities <a class="header-anchor" href="#reuse-opportunities" aria-label="Permalink to &quot;Reuse Opportunities&quot;">​</a></h4><p>These controls can be reused across Fresh:</p><table tabindex="0"><thead><tr><th>Control</th><th>Settings Editor</th><th>Other Uses</th></tr></thead><tbody><tr><td>Toggle</td><td>Boolean settings</td><td>View menu checkboxes, confirmation dialogs</td></tr><tr><td>NumberInput</td><td>Numeric settings</td><td>Goto line dialog, width/height inputs</td></tr><tr><td>Dropdown</td><td>Enum settings</td><td>Theme selector, keybinding map selector</td></tr><tr><td>TextInput</td><td>String settings</td><td>Search field, rename dialog</td></tr><tr><td>TextList</td><td>Array settings</td><td>Custom ignore patterns</td></tr><tr><td>Button</td><td>Action buttons</td><td>Confirmation dialogs, wizard navigation</td></tr></tbody></table><h3 id="state-management-design" tabindex="-1">State Management Design <a class="header-anchor" href="#state-management-design" aria-label="Permalink to &quot;State Management Design&quot;">​</a></h3><h4 id="settingsstate-structure" tabindex="-1">SettingsState Structure <a class="header-anchor" href="#settingsstate-structure" aria-label="Permalink to &quot;SettingsState Structure&quot;">​</a></h4><ul><li><code>original_config</code>: Snapshot of config at open time</li><li><code>working_config</code>: Current config with pending changes</li><li><code>pending_changes</code>: Map of setting paths to their changed values (for modified indicators)</li><li><code>selected_category</code>: Current category/subcategory path</li><li><code>selected_setting</code>: Index within current category</li><li><code>focus</code>: Which panel has focus (Tree, Settings, Search, Control)</li><li><code>control_states</code>: Map of setting paths to their control states</li><li><code>search_query</code>: Current search text</li><li><code>search_results</code>: Filtered settings matching query</li><li><code>scroll_offsets</code>: Per-category scroll positions</li></ul><h4 id="change-detection" tabindex="-1">Change Detection <a class="header-anchor" href="#change-detection" aria-label="Permalink to &quot;Change Detection&quot;">​</a></h4><ul><li>Compare <code>working_config</code> field values against <code>original_config</code></li><li>Track which settings have <code>pending_changes</code> for the <code>●</code> modified indicator</li><li>On save: write <code>working_config</code> to disk, update <code>original_config</code></li><li>On cancel: restore from <code>original_config</code></li></ul><h3 id="json-schema-based-config-integration" tabindex="-1">JSON Schema-Based Config Integration <a class="header-anchor" href="#json-schema-based-config-integration" aria-label="Permalink to &quot;JSON Schema-Based Config Integration&quot;">​</a></h3><p>Use JSON Schema as the standard, well-understood format for describing config structure. The schema is already generated from Rust types via <code>#[derive(JsonSchema)]</code>, making it the obvious choice.</p><h4 id="research-how-zed-does-it" tabindex="-1">Research: How Zed Does It <a class="header-anchor" href="#research-how-zed-does-it" aria-label="Permalink to &quot;Research: How Zed Does It&quot;">​</a></h4><p>Zed&#39;s settings UI uses a <strong>field accessor pattern</strong> (<a href="https://zed.dev/blog/settings-ui" target="_blank" rel="noreferrer">source</a>):</p><ul><li><code>SettingField&lt;T&gt;</code> with function pointers for pick/write operations</li><li>Type-based renderer registry mapping <code>TypeId</code> to control renderers</li><li>Manual <code>SettingItem</code> definitions with title, description, field accessors</li></ul><p><strong>Key insight</strong>: Zed initially tried a <strong>macro-based approach</strong> where settings were annotated with UI metadata, but abandoned it because it &quot;glued UI concerns into non-UI crates.&quot;</p><h4 id="our-approach-json-schema" tabindex="-1">Our Approach: JSON Schema <a class="header-anchor" href="#our-approach-json-schema" aria-label="Permalink to &quot;Our Approach: JSON Schema&quot;">​</a></h4><p>We already have <code>#[derive(JsonSchema)]</code> on Config types. Rather than building custom accessor infrastructure, use the schema directly:</p><p><strong>Why JSON Schema is better for Fresh:</strong></p><ul><li><strong>Standard format</strong>: Well-known, tooling exists, self-documenting</li><li><strong>Already generated</strong>: We have <code>schemars</code> derive, just need proper generation</li><li><strong>Obvious mapping</strong>: Schema types → UI controls is mechanical</li><li><strong>External tooling</strong>: LSP can validate config files, editors get autocomplete</li><li><strong>Less code</strong>: No <code>SettingField&lt;T&gt;</code>, no <code>field!</code> macro, no registry</li></ul><p><strong>Schema → UI Mapping:</strong></p><table tabindex="0"><thead><tr><th>JSON Schema</th><th>Control Type</th></tr></thead><tbody><tr><td><code>type: &quot;boolean&quot;</code></td><td>Toggle</td></tr><tr><td><code>type: &quot;integer&quot;</code></td><td>NumberInput</td></tr><tr><td><code>type: &quot;number&quot;</code></td><td>NumberInput</td></tr><tr><td><code>type: &quot;string&quot;</code> + <code>enum</code></td><td>Dropdown</td></tr><tr><td><code>type: &quot;string&quot;</code></td><td>TextInput</td></tr><tr><td><code>type: &quot;object&quot;</code></td><td>Section (recurse into properties)</td></tr><tr><td><code>type: &quot;array&quot;</code></td><td>TextList</td></tr><tr><td><code>$ref</code></td><td>Resolve and recurse</td></tr></tbody></table><p><strong>Information from schema:</strong></p><table tabindex="0"><thead><tr><th>UI Need</th><th>Schema Source</th></tr></thead><tbody><tr><td>Label</td><td>Property name → Title Case</td></tr><tr><td>Description</td><td><code>description</code> field</td></tr><tr><td>Default value</td><td><code>default</code> field</td></tr><tr><td>Control type</td><td><code>type</code> field</td></tr><tr><td>Enum options</td><td><code>enum</code> array</td></tr><tr><td>Categories</td><td>Object nesting / <code>$ref</code> structure</td></tr></tbody></table><h4 id="read-write-via-json-pointers" tabindex="-1">Read/Write via JSON Pointers <a class="header-anchor" href="#read-write-via-json-pointers" aria-label="Permalink to &quot;Read/Write via JSON Pointers&quot;">​</a></h4><p>Use serde_json&#39;s pointer API for dynamic access:</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Read</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> serde_json</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">to_value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tab_size </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pointer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/editor/tab_size&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Write</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> mut</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> serde_json</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">to_value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pointer_mut</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/editor/tab_size&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unwrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> json!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> serde_json</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from_value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(value)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>This trades compile-time field access safety for simplicity. Errors are caught at:</p><ol><li>Schema validation (structure matches)</li><li>Serde deserialization (types match)</li></ol><h4 id="category-structure-from-schema" tabindex="-1">Category Structure (from schema) <a class="header-anchor" href="#category-structure-from-schema" aria-label="Permalink to &quot;Category Structure (from schema)&quot;">​</a></h4><p>Derived automatically from schema&#39;s object nesting:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;$defs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;Config&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;properties&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;theme&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;string&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Color theme...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;editor&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;$ref&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;#/$defs/EditorConfig&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;EditorConfig&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;properties&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;tab_size&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;integer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Spaces per tab...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;line_numbers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;boolean&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Show line numbers...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>UI walks this structure to build:</p><ul><li>Top-level properties → Top-level settings</li><li><code>$ref</code> to object types → Collapsible sections</li><li>Nested properties → Settings within sections</li></ul><h3 id="input-handling-integration" tabindex="-1">Input Handling Integration <a class="header-anchor" href="#input-handling-integration" aria-label="Permalink to &quot;Input Handling Integration&quot;">​</a></h3><h4 id="new-actions" tabindex="-1">New Actions <a class="header-anchor" href="#new-actions" aria-label="Permalink to &quot;New Actions&quot;">​</a></h4><p>Add to the <code>Action</code> enum:</p><ul><li><code>OpenSettings</code> - Open settings modal</li><li><code>SettingsClose</code> - Close settings (with unsaved check)</li><li><code>SettingsSave</code> - Save and stay open</li><li><code>SettingsSearch</code> - Focus search field</li><li><code>SettingsNavigate(Direction)</code> - Move between settings</li><li><code>SettingsToggle</code> - Toggle current boolean / expand dropdown</li><li><code>SettingsEdit</code> - Enter edit mode for current control</li><li><code>SettingsReset</code> - Reset current setting to default</li></ul><h4 id="keybinding-defaults" tabindex="-1">Keybinding Defaults <a class="header-anchor" href="#keybinding-defaults" aria-label="Permalink to &quot;Keybinding Defaults&quot;">​</a></h4><p>Register these in the <code>default</code> keymap for <code>KeyContext::Settings</code>:</p><ul><li><code>Escape</code> → <code>CloseSettings</code></li><li><code>/</code> → <code>SettingsSearch</code></li><li><code>Up/Down</code> → Navigate settings</li><li><code>Left/Right</code> → Increment/decrement values, or navigate footer buttons</li><li><code>Enter</code> → Toggle/activate current control</li><li><code>Tab</code> → Cycle focus between panels (categories → settings → footer)</li><li><code>?</code> → Show help overlay</li></ul><h3 id="rendering-integration" tabindex="-1">Rendering Integration <a class="header-anchor" href="#rendering-integration" aria-label="Permalink to &quot;Rendering Integration&quot;">​</a></h3><h4 id="entry-point" tabindex="-1">Entry Point <a class="header-anchor" href="#entry-point" aria-label="Permalink to &quot;Entry Point&quot;">​</a></h4><p>Add settings rendering in <code>Editor.render()</code> after popups but before menu:</p><ul><li>Check if <code>settings_state</code> is <code>Some</code></li><li>Call <code>SettingsRenderer::render()</code> with full-screen area</li><li>Settings modal overlays everything except menu bar</li></ul><h4 id="two-panel-layout" tabindex="-1">Two-Panel Layout <a class="header-anchor" href="#two-panel-layout" aria-label="Permalink to &quot;Two-Panel Layout&quot;">​</a></h4><p>The renderer calculates layout based on terminal width:</p><ul><li>Wide mode (≥80 cols): Side-by-side panels</li><li>Narrow mode (&lt;80 cols): Stacked panels with breadcrumb</li></ul><h4 id="render-order" tabindex="-1">Render Order <a class="header-anchor" href="#render-order" aria-label="Permalink to &quot;Render Order&quot;">​</a></h4><p>Within the settings modal:</p><ol><li>Clear background</li><li>Render border and title with change count</li><li>Render category tree (left panel)</li><li>Render settings list (right panel)</li><li>Render active control overlay (dropdown menu, etc.)</li><li>Render footer with keyboard shortcuts</li><li>Render search overlay if active</li><li>Render help overlay if active</li></ol><h3 id="mouse-support" tabindex="-1">Mouse Support <a class="header-anchor" href="#mouse-support" aria-label="Permalink to &quot;Mouse Support&quot;">​</a></h3><p>Following the <code>FileBrowserLayout</code> pattern:</p><p><strong>SettingsLayout</strong> tracks hit regions:</p><ul><li><code>tree_area</code>: Category tree panel</li><li><code>settings_area</code>: Settings list panel</li><li><code>search_area</code>: Search field</li><li><code>per_setting_areas</code>: Vec of (Rect, SettingPath) for each visible setting</li><li><code>control_layouts</code>: Map of active control layouts</li></ul><p><strong>HoverTarget variants</strong> (add to existing enum):</p><ul><li><code>SettingsCategory(CategoryPath)</code></li><li><code>SettingRow(SettingPath)</code></li><li><code>SettingsControl(SettingPath, ControlRegion)</code></li><li><code>SettingsScrollbar</code></li></ul><hr><h2 id="migration-from-plugin-✅-complete" tabindex="-1">Migration from Plugin ✅ COMPLETE <a class="header-anchor" href="#migration-from-plugin-✅-complete" aria-label="Permalink to &quot;Migration from Plugin ✅ COMPLETE&quot;">​</a></h2><p>The <code>plugins/config_editor.ts</code> plugin has been fully removed. The built-in Settings UI is now the only way to edit configuration (besides directly editing config.json).</p><h3 id="what-was-done" tabindex="-1">What was done: <a class="header-anchor" href="#what-was-done" aria-label="Permalink to &quot;What was done:&quot;">​</a></h3><ol><li>✅ Implemented native settings view in Rust</li><li>✅ Added <code>OpenSettings</code> action to command palette</li><li>✅ Added <code>Ctrl+,</code> keybinding to open Settings</li><li>✅ Added &quot;Settings...&quot; to Edit menu</li><li>✅ Removed <code>config_editor.ts</code> plugin and its e2e tests</li><li>✅ Removed <code>s</code> and <code>Ctrl+S</code> keybindings (previously used by plugin)</li><li>✅ Settings dialog now consumes all keyboard input (global shortcuts don&#39;t leak through)</li><li>✅ Theme and keybinding changes are applied immediately after saving</li></ol><h3 id="advantages-of-native-implementation" tabindex="-1">Advantages of Native Implementation <a class="header-anchor" href="#advantages-of-native-implementation" aria-label="Permalink to &quot;Advantages of Native Implementation&quot;">​</a></h3><ul><li>Faster startup (no JavaScript evaluation)</li><li>Direct access to Config struct and schema</li><li>Better keyboard handling (consumes all input when modal is open)</li><li>Consistent with other native UI components</li><li>No TextEncoder/TextDecoder polyfill issues</li><li>Runtime state updates (theme, keybindings) applied immediately</li></ul><hr><h2 id="implementation-plan" tabindex="-1">Implementation Plan <a class="header-anchor" href="#implementation-plan" aria-label="Permalink to &quot;Implementation Plan&quot;">​</a></h2><h3 id="status-summary" tabindex="-1">Status Summary <a class="header-anchor" href="#status-summary" aria-label="Permalink to &quot;Status Summary&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Phase</th><th>Status</th><th>Notes</th></tr></thead><tbody><tr><td>Phase 1: Controls Module</td><td>✅ DONE</td><td>All controls implemented with tests</td></tr><tr><td>Phase 2: Schema Generation</td><td>✅ DONE</td><td>5-line binary replaces 620-line build.rs</td></tr><tr><td>Phase 3: Settings UI</td><td>✅ DONE</td><td>Basic modal with navigation working</td></tr><tr><td>Phase 4: Search &amp; Polish</td><td>✅ DONE</td><td>Help overlay, confirmation dialog, search UI all working</td></tr><tr><td>Phase 5: Migration</td><td>✅ DONE</td><td>Plugin removed, Settings UI is now the only config editor</td></tr></tbody></table><h3 id="current-implementation-details" tabindex="-1">Current Implementation Details <a class="header-anchor" href="#current-implementation-details" aria-label="Permalink to &quot;Current Implementation Details&quot;">​</a></h3><p>The settings panel now includes:</p><ol><li><p><strong>Description display</strong>: Each setting shows its description below the control in a subdued color. Descriptions are truncated with &quot;...&quot; if they exceed the available width.</p></li><li><p><strong>Smart highlighting</strong>: Selection and hover highlights only cover content rows (control + description), not the empty spacing row between items. This provides cleaner visual feedback.</p></li><li><p><strong>Horizontal padding</strong>: Settings panel content has 2-character padding from the vertical separator for better visual separation.</p></li><li><p><strong>Column alignment</strong>: All single-row controls (Toggle, Number, Dropdown, Text) align their labels in columns using a calculated maximum label width.</p></li></ol><h3 id="known-bugs-found-during-testing" tabindex="-1">Known Bugs (found during testing) <a class="header-anchor" href="#known-bugs-found-during-testing" aria-label="Permalink to &quot;Known Bugs (found during testing)&quot;">​</a></h3><h4 id="critical-ux-gaps-blocking-intuitive-use" tabindex="-1">Critical UX Gaps (blocking intuitive use) <a class="header-anchor" href="#critical-ux-gaps-blocking-intuitive-use" aria-label="Permalink to &quot;Critical UX Gaps (blocking intuitive use)&quot;">​</a></h4><p>The following issues make the Settings UI difficult or impossible to use for common tasks:</p><ol><li><p><strong>Complex settings not editable</strong> - Keybindings and LSP settings cannot be added/edited through the UI. Users must edit <code>config.toml</code> directly for these.</p></li><li><p><s><strong>[+] Add new buttons non-functional</strong></s> - ✅ Fixed: Map controls now show text input when pressing Enter on &quot;[+] Add new&quot;.</p></li><li><p><s><strong>Search is broken</strong></s> - ✅ Fixed: Search field now displays typed text correctly.</p></li><li><p><s><strong>No selection indicators</strong></s> - ✅ Fixed: Selection highlighting now shows for both categories and settings.</p></li><li><p><s><strong>Empty Unsaved Changes dialog</strong></s> - ✅ Verified working: Dialog correctly displays pending changes.</p></li></ol><h4 id="bug-table" tabindex="-1">Bug Table <a class="header-anchor" href="#bug-table" aria-label="Permalink to &quot;Bug Table&quot;">​</a></h4><table tabindex="0"><thead><tr><th>Bug</th><th>Severity</th><th>Status</th><th>Description</th></tr></thead><tbody><tr><td>Keybindings not editable</td><td>High</td><td>Open</td><td>Shows <code>&lt;Complex - edit in config.toml&gt;</code>. Need table UI for key/modifiers/action entries.</td></tr><tr><td>Menus not editable</td><td>High</td><td>Open</td><td>Shows <code>&lt;Complex - edit in config.toml&gt;</code>. Need hierarchical tree UI for menu structure.</td></tr><tr><td>Map entry values not editable</td><td>High</td><td>Open</td><td>Map entries show <code>{N fields}</code> but expanding/editing individual fields not implemented.</td></tr><tr><td>Dropdown editing doesn&#39;t work</td><td>High</td><td>✅ Fixed</td><td>Enter/arrows on dropdown now work correctly.</td></tr><tr><td>Number input editing not implemented</td><td>High</td><td>✅ Fixed</td><td>Enter to edit, type value, Enter to confirm. Left/Right also increment/decrement.</td></tr><tr><td>No settings item selection indicator</td><td>Medium</td><td>✅ Fixed</td><td>Selection highlighting now shows for focused settings items.</td></tr><tr><td>View doesn&#39;t scroll to selection</td><td>Medium</td><td>Open</td><td>After search jump, view doesn&#39;t scroll to show the selected item.</td></tr><tr><td>Search text input broken</td><td>High</td><td>✅ Fixed</td><td>Search field now displays typed text correctly.</td></tr><tr><td>Confirmation dialog empty</td><td>Medium</td><td>✅ Fixed</td><td>Dialog height calculation was off by 1, causing changes to overlap with separator.</td></tr><tr><td>No button selection indicator</td><td>Medium</td><td>✅ Fixed</td><td>Added &gt; indicator and bold styling for selected button.</td></tr><tr><td>No panel focus indicator</td><td>Low</td><td>Open</td><td>Can&#39;t visually tell if categories or settings panel has focus. Footer panel shows focus (&gt;) but categories/settings don&#39;t.</td></tr><tr><td>Terminal captures input when Settings opens</td><td>High</td><td>✅ Fixed</td><td>Added Settings to popup/prompt check in input routing. Also added OpenSettings to terminal UI actions.</td></tr><tr><td>Footer buttons inaccessible via keyboard</td><td>High</td><td>✅ Fixed</td><td>Added FocusPanel enum with Categories/Settings/Footer states. Tab now cycles through all three panels. Footer buttons now navigable with Left/Right arrows.</td></tr><tr><td>Global shortcuts leak through Settings</td><td>High</td><td>✅ Fixed</td><td>Ctrl+P (palette), Ctrl+Q (quit), etc. were not consumed when Settings was open. Fixed by consuming all unhandled keys in Settings context.</td></tr><tr><td>Search results unrelated to query</td><td>Medium</td><td>Open</td><td>Searching &quot;font&quot; returns 14 results with no &quot;font&quot; matches. Fuzzy matching too aggressive or broken.</td></tr><tr><td>&quot;●&quot; indicator unexplained</td><td>Low</td><td>Open</td><td>Some categories show ● with no explanation. Users don&#39;t know if it means unsaved changes, errors, etc.</td></tr><tr><td>Left/Right for +/- undiscoverable</td><td>Low</td><td>Open</td><td>Arrow keys increment/decrement number fields but help text only shows &quot;↑↓:Navigate&quot;.</td></tr><tr><td>Cancel in Unsaved Changes dialog closes everything</td><td>Medium</td><td>Open</td><td>&quot;Cancel&quot; should return to Settings, but instead closes the entire dialog like Discard.</td></tr><tr><td>[+] Add new buttons don&#39;t respond</td><td>High</td><td>✅ Fixed</td><td>Map controls now show text input field when pressing Enter on &quot;[+] Add new&quot;. Type key name, press Enter to add entry.</td></tr><tr><td>Empty Unsaved Changes dialog persists</td><td>Medium</td><td>✅ Fixed</td><td>Dialog now correctly displays pending changes (e.g., &quot;• /check_for_updates: true&quot;).</td></tr><tr><td>Dropdown options have no selection indicator</td><td>Low</td><td>Open</td><td>When dropdown is open, no visible highlight shows which option is selected (only preview updates).</td></tr><tr><td>Escape doesn&#39;t close Settings directly</td><td>Low</td><td>Open</td><td>Help text says &quot;Esc:Close&quot; but Escape only triggers unsaved changes flow, doesn&#39;t close directly.</td></tr><tr><td>Theme not applied after save</td><td>High</td><td>✅ Fixed</td><td>save_settings() now updates runtime state (theme, keybindings) after saving config.</td></tr><tr><td>Number input appends instead of replaces</td><td>Medium</td><td>Open</td><td>When pressing Enter to edit a number field, typing appends to existing value instead of replacing. User must manually clear with Backspace first.</td></tr><tr><td>Category selection indicator missing</td><td>Medium</td><td>✅ Fixed</td><td>Selection highlighting now shows for focused category in the left panel.</td></tr><tr><td>Language entries not expandable</td><td>High</td><td>Open</td><td>Individual language configurations (extensions, grammar, comment prefix, etc.) cannot be viewed or edited. Only the enabled checkbox is accessible.</td></tr><tr><td>No LSP settings section visible</td><td>Medium</td><td>Open</td><td>LSP/Language Server settings mentioned in design doc are not visible. No way to configure LSP servers from Settings UI.</td></tr></tbody></table><h3 id="phase-1-core-controls-module-✅" tabindex="-1">Phase 1: Core Controls Module ✅ <a class="header-anchor" href="#phase-1-core-controls-module-✅" aria-label="Permalink to &quot;Phase 1: Core Controls Module ✅&quot;">​</a></h3><p>Create reusable form controls that can be used independently of settings.</p><p><strong>New files:</strong></p><ul><li><code>src/view/controls/mod.rs</code> - Control types enum and common rendering utilities</li><li><code>src/view/controls/toggle.rs</code> - ToggleState, render_toggle(), ToggleLayout</li><li><code>src/view/controls/number_input.rs</code> - NumberInputState, render_number_input()</li><li><code>src/view/controls/dropdown.rs</code> - DropdownState, render_dropdown()</li><li><code>src/view/controls/text_input.rs</code> - TextInputState, render_text_input()</li><li><code>src/view/controls/button.rs</code> - ButtonState, render_button()</li></ul><p><strong>Design principles:</strong></p><ul><li>Each control is self-contained with state, render function, and layout</li><li>Controls follow the scrollbar pattern: state struct + render function + layout struct</li><li>Theme-aware: all colors from Theme struct</li><li>Keyboard and mouse support in layouts</li><li>No dependencies on settings-specific code</li></ul><h3 id="phase-2-robust-schema-generation" tabindex="-1">Phase 2: Robust Schema Generation <a class="header-anchor" href="#phase-2-robust-schema-generation" aria-label="Permalink to &quot;Phase 2: Robust Schema Generation&quot;">​</a></h3><p>The current <code>build.rs</code> uses ~600 lines of custom Rust parsing to extract config structure. This is fragile and duplicates what <code>schemars</code> already provides. Replace with a proper approach.</p><h4 id="current-problem" tabindex="-1">Current Problem <a class="header-anchor" href="#current-problem" aria-label="Permalink to &quot;Current Problem&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>build.rs (fragile):</span></span>
<span class="line"><span>├── Custom regex-like parsing of Rust source</span></span>
<span class="line"><span>├── Manually extracts structs, fields, doc comments</span></span>
<span class="line"><span>├── Reimplements serde attribute parsing</span></span>
<span class="line"><span>├── Breaks on edge cases</span></span>
<span class="line"><span>└── Hard to maintain</span></span></code></pre></div><h4 id="solution-schema-generation-binary" tabindex="-1">Solution: Schema Generation Binary <a class="header-anchor" href="#solution-schema-generation-binary" aria-label="Permalink to &quot;Solution: Schema Generation Binary&quot;">​</a></h4><p>Add a simple binary that uses schemars properly:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>src/bin/</span></span>
<span class="line"><span>└── generate_schema.rs  # Uses schemars::schema_for!(Config)</span></span></code></pre></div><p><strong>Schema generation is trivial (5 lines):</strong></p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> schemars</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">schema_for!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    println!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">serde_json</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">to_string_pretty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">schema)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unwrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>Usage:</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cargo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --features</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev-bins</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --bin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> generate_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> plugins/config-schema.json</span></span></code></pre></div><p><strong>CI verification</strong> (in <code>.github/workflows/ci.yml</code>):</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Generate schema</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cargo run --features dev-bins --bin generate_schema &gt; /tmp/config-schema.json</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Check schema is up-to-date</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">diff -u plugins/config-schema.json /tmp/config-schema.json</span></span></code></pre></div><h4 id="benefits" tabindex="-1">Benefits <a class="header-anchor" href="#benefits" aria-label="Permalink to &quot;Benefits&quot;">​</a></h4><ul><li><strong>Standard tooling</strong>: Uses schemars as intended, no custom parsing</li><li><strong>Correct by construction</strong>: Schema always matches types exactly</li><li><strong>Maintainable</strong>: Deleted ~620 lines from build.rs, replaced with 5-line binary</li><li><strong>CI verified</strong>: Schema drift is caught in CI</li><li><strong>No restructuring needed</strong>: Config types stay in main crate</li></ul><h3 id="phase-3-settings-ui-with-schema" tabindex="-1">Phase 3: Settings UI with Schema <a class="header-anchor" href="#phase-3-settings-ui-with-schema" aria-label="Permalink to &quot;Phase 3: Settings UI with Schema&quot;">​</a></h3><p>Build the settings UI that reads from JSON Schema.</p><p><strong>New files:</strong></p><ul><li><code>src/view/settings/schema.rs</code> - Parse schema, build category tree</li><li><code>src/view/settings/items.rs</code> - <code>SettingItem</code>, <code>SettingsPage</code> from schema</li><li><code>src/view/settings/state.rs</code> - SettingsState, change tracking</li><li><code>src/view/settings/render.rs</code> - SettingsRenderer</li></ul><p><strong>Implementation approach:</strong></p><ul><li>Load schema at startup (from embedded file or runtime generation)</li><li>Walk schema <code>$defs</code> and <code>properties</code> to build UI structure</li><li>Map JSON Schema types to controls: <ul><li><code>type: &quot;boolean&quot;</code> → Toggle</li><li><code>type: &quot;integer&quot;</code> / <code>type: &quot;number&quot;</code> → NumberInput</li><li><code>type: &quot;string&quot;</code> + <code>enum</code> → Dropdown</li><li><code>type: &quot;string&quot;</code> → TextInput</li><li><code>type: &quot;object&quot;</code> → Section (recurse)</li><li><code>type: &quot;array&quot;</code> → TextList</li></ul></li><li>Use <code>description</code> field for setting descriptions</li><li>Use <code>default</code> field for reset functionality</li><li>Use JSON pointer paths for read/write (<code>/editor/tab_size</code>)</li></ul><p><strong>Read/write via serde_json:</strong></p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Read current value</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> config_value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> serde_json</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">to_value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tab_size </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> config_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pointer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/editor/tab_size&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Write new value</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> mut</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> config_value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> serde_json</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">to_value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pointer_mut</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/editor/tab_size&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unwrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> new_val;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> serde_json</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from_value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(config_value)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p><strong>Additional files:</strong></p><ul><li><code>src/view/settings/layout.rs</code> - SettingsLayout for hit testing</li></ul><p><strong>Modifications:</strong></p><ul><li><code>src/app/mod.rs</code> - Add <code>settings_state: Option&lt;SettingsState&gt;</code> to Editor</li><li><code>src/app/render.rs</code> - Render settings modal when active</li><li><code>src/input/keybindings.rs</code> - Add <code>KeyContext::Settings</code> and related actions</li><li><code>src/app/input.rs</code> - Handle settings actions</li></ul><h3 id="phase-4-search-polish" tabindex="-1">Phase 4: Search &amp; Polish <a class="header-anchor" href="#phase-4-search-polish" aria-label="Permalink to &quot;Phase 4: Search &amp; Polish&quot;">​</a></h3><p>Add search functionality and UX polish.</p><p><strong>New files:</strong></p><ul><li><code>src/view/settings/search.rs</code> - Fuzzy search over settings</li></ul><p><strong>Features:</strong></p><ul><li>Fuzzy matching on setting names and descriptions</li><li>Highlight matching categories in tree</li><li>Search results panel with breadcrumbs</li><li>Help overlay (?)</li><li>Unsaved changes confirmation dialog</li></ul><h3 id="phase-5-migration-cleanup-✅" tabindex="-1">Phase 5: Migration &amp; Cleanup ✅ <a class="header-anchor" href="#phase-5-migration-cleanup-✅" aria-label="Permalink to &quot;Phase 5: Migration &amp; Cleanup ✅&quot;">​</a></h3><p>Replace the plugin-based config editor.</p><p><strong>Completed steps:</strong></p><ol><li>✅ Added command palette entry &quot;Settings&quot; → <code>OpenSettings</code> action</li><li>✅ Added &quot;Settings...&quot; to Edit menu</li><li>✅ Added keyboard shortcut <code>Ctrl+,</code></li><li>✅ Removed <code>config_editor.ts</code> plugin entirely</li><li>✅ Removed <code>s</code> and <code>Ctrl+S</code> keybindings from default keymap</li><li>✅ Settings dialog consumes all keyboard input (no global shortcut leakage)</li><li>✅ Runtime state (theme, keybindings) updated immediately on save</li></ol><hr><h2 id="design-decisions" tabindex="-1">Design Decisions <a class="header-anchor" href="#design-decisions" aria-label="Permalink to &quot;Design Decisions&quot;">​</a></h2><h3 id="why-not-extend-popupmanager" tabindex="-1">Why Not Extend PopupManager? <a class="header-anchor" href="#why-not-extend-popupmanager" aria-label="Permalink to &quot;Why Not Extend PopupManager?&quot;">​</a></h3><p>The settings editor is too complex for the popup system:</p><ul><li>Needs two-panel layout with independent scrolling</li><li>Requires persistent state across focus changes</li><li>Has multiple layers of controls (dropdown over settings panel)</li><li>Needs full keyboard navigation with context switching</li></ul><p>Instead, settings is a modal view like the file picker, but with richer UI.</p><h3 id="why-separate-controls-module" tabindex="-1">Why Separate Controls Module? <a class="header-anchor" href="#why-separate-controls-module" aria-label="Permalink to &quot;Why Separate Controls Module?&quot;">​</a></h3><p>Form controls are generally useful beyond settings:</p><ul><li>Goto line dialog could use NumberInput</li><li>Rename dialog could use TextInput</li><li>Confirmation dialogs could use Button</li><li>Menu items with toggles could use Toggle</li></ul><p>Extracting controls enables gradual adoption without modifying existing code.</p><h3 id="why-json-schema-over-other-approaches" tabindex="-1">Why JSON Schema Over Other Approaches? <a class="header-anchor" href="#why-json-schema-over-other-approaches" aria-label="Permalink to &quot;Why JSON Schema Over Other Approaches?&quot;">​</a></h3><p>Alternatives considered:</p><ol><li><p><strong>Derive macro on Config types</strong>: <code>#[derive(SettingsUI)]</code> generates metadata</p><ul><li>Con: Zed tried this and abandoned it - &quot;glued UI concerns into non-UI crates&quot;</li><li>Con: Harder to control ordering, grouping, custom descriptions</li></ul></li><li><p><strong>Visitor pattern</strong>: Config types implement trait to describe themselves</p><ul><li>Con: Still couples UI metadata to data types</li><li>Con: Requires manual trait impls or proc macro</li></ul></li><li><p><strong>Field accessor pattern</strong> (Zed&#39;s approach):</p><ul><li>Pro: Type-safe via function pointers</li><li>Con: Requires defining every setting manually in UI code</li><li>Con: More infrastructure to build (<code>SettingField&lt;T&gt;</code>, registry, etc.)</li></ul></li><li><p><strong>JSON Schema</strong> (chosen):</p><ul><li>Pro: Standard format, well-understood</li><li>Pro: Already generated via <code>#[derive(JsonSchema)]</code></li><li>Pro: Automatic - new Config fields appear in UI automatically</li><li>Pro: External tooling (LSP validation, editor autocomplete)</li><li>Pro: Less custom code - just walk the schema</li><li>Con: Runtime type safety only (caught by serde on deserialize)</li></ul></li></ol><p><strong>The key insight</strong>: We already have the schema. The current problem is <em>how</em> we generate it (fragile build.rs parsing), not <em>whether</em> to use it. Fix the generation, keep the schema.</p><hr><h2 id="scrollablepanel-abstraction" tabindex="-1">ScrollablePanel Abstraction <a class="header-anchor" href="#scrollablepanel-abstraction" aria-label="Permalink to &quot;ScrollablePanel Abstraction&quot;">​</a></h2><p>The settings panel scrolling logic should be extracted into a reusable <code>ScrollablePanel</code> component. This follows patterns from established UI frameworks.</p><h3 id="inspiration-from-other-frameworks" tabindex="-1">Inspiration from Other Frameworks <a class="header-anchor" href="#inspiration-from-other-frameworks" aria-label="Permalink to &quot;Inspiration from Other Frameworks&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Framework</th><th>Component</th><th>Key Patterns</th></tr></thead><tbody><tr><td>Flutter</td><td><code>ListView</code> / <code>Sliver</code></td><td>Items report size, <code>Scrollable.ensureVisible()</code></td></tr><tr><td>WPF/WinUI</td><td><code>ScrollViewer</code></td><td><code>BringIntoView()</code>, pixel-based scrolling</td></tr><tr><td>Qt</td><td><code>QAbstractScrollArea</code></td><td>Viewport + scroll position, <code>ensureWidgetVisible()</code></td></tr><tr><td>Web/React</td><td><code>react-window</code></td><td>Virtual scrolling, dynamic measurement</td></tr></tbody></table><h3 id="core-design" tabindex="-1">Core Design <a class="header-anchor" href="#core-design" aria-label="Permalink to &quot;Core Design&quot;">​</a></h3><h4 id="scrollstate-pure-state-management" tabindex="-1">ScrollState - Pure State Management <a class="header-anchor" href="#scrollstate-pure-state-management" aria-label="Permalink to &quot;ScrollState - Pure State Management&quot;">​</a></h4><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// Pure scroll state - knows nothing about content</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ScrollState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Scroll offset in rows (not items)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> offset</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Viewport height</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> viewport</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Total content height</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content_height</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">impl</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ScrollState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Create new scroll state</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(viewport</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Update content height (call when items change)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> set_content_height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;mut</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, height</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Scroll to ensure a region is visible</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// If region is taller than viewport, shows the top</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ensure_visible</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;mut</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, y</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, height</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">offset {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // Region is above viewport - scroll up</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">offset </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> y;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">offset </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">viewport {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // Region is below viewport - scroll down</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">viewport {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // Oversized item - show top</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">offset </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> y;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">offset </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">viewport;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Scroll by delta rows (positive = down, negative = up)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> scroll_by</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;mut</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, delta</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> i16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Scroll to a ratio (0.0 = top, 1.0 = bottom)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> scroll_to_ratio</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;mut</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ratio</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> f32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Get scrollbar thumb ratio (size relative to track)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> thumb_ratio</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> f32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">viewport </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> f32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content_height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> f32</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Get scrollbar thumb position (0.0 to 1.0)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> thumb_position</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> f32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">offset </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> f32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content_height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">viewport) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> f32</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Check if scrolling is needed</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> needs_scrollbar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content_height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">viewport</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="scrollitem-trait-item-size-reporting" tabindex="-1">ScrollItem Trait - Item Size Reporting <a class="header-anchor" href="#scrollitem-trait-item-size-reporting" aria-label="Permalink to &quot;ScrollItem Trait - Item Size Reporting&quot;">​</a></h4><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// Trait for items that can be displayed in a scrollable panel</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> trait</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ScrollItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Total height of this item in terminal rows</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Optional: sub-focus regions within this item</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Used for items with internal navigation (e.g., TextList rows)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> focus_regions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FocusRegion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// A focusable region within an item</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FocusRegion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Identifier for this region</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> usize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Y offset within the parent item</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> y_offset</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Height of this region</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> height</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="scrollablepanel-rendering-coordinator" tabindex="-1">ScrollablePanel - Rendering Coordinator <a class="header-anchor" href="#scrollablepanel-rendering-coordinator" aria-label="Permalink to &quot;ScrollablePanel - Rendering Coordinator&quot;">​</a></h4><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// Manages scrolling for a list of items</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ScrollablePanel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    scroll</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ScrollState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">impl</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ScrollablePanel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(viewport_height</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Update scroll state for new viewport size</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> set_viewport</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;mut</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, height</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Calculate total content height from items</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> update_content_height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">I</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ScrollItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;mut</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, items</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">I</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> height</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u16</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> items</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scroll</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set_content_height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(height);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Ensure focused item (and optional sub-region) is visible</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ensure_focused_visible</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">I</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ScrollItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        &amp;mut</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        items</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">I</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        focused_index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> usize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        sub_focus</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">usize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Calculate Y offset of focused item</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item_y</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u16</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> items[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">..</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">focused_index]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">items[focused_index];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // If sub-focus specified, use that region</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (focus_y, focus_h) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> let</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Some</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sub_id) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sub_focus {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> let</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Some</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(region) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">focus_regions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sub_id) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                (item_y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> region</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">y_offset, region</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">height)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                (item_y, item</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            (item_y, item</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scroll</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ensure_visible</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(focus_y, focus_h);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Render visible items and scrollbar</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Returns layout info for hit testing</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">I</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">F</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">L</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        &amp;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        frame</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;mut</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Rect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        items</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">I</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        render_item</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> F</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        theme</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Theme</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ScrollablePanelLayout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">L</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    where</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        I</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ScrollItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        F</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;mut</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Rect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">I</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">usize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> L</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scrollbar_width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scroll</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">needs_scrollbar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> };</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content_area </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Rect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">y,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">width</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">saturating_sub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(scrollbar_width),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">height,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> mut</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> layouts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Vec</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> mut</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> current_y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">u16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> mut</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> render_y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">y;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (idx, item) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> items</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">enumerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item_h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // Skip items before scroll offset</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> current_y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item_h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scroll</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">offset {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                current_y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item_h;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                continue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // Stop if past viewport</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> render_y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">height {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // Calculate visible portion of item</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> skip_top </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scroll</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">offset</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">saturating_sub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(current_y);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> available_h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">height)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">saturating_sub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(render_y);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> visible_h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (item_h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> skip_top)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(available_h);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item_area </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Rect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(content_area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x, render_y, content_area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">width, visible_h);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> layout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> render_item</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(frame, item_area, item, idx);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            layouts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((idx, layout));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            render_y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> visible_h;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            current_y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item_h;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Render scrollbar if needed</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scroll</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">needs_scrollbar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scrollbar_area </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Rect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content_area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">width,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">y,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">height,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            );</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scrollbar_state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ScrollbarState</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scroll</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content_height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> usize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scroll</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">viewport </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> usize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scroll</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">offset </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> usize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            );</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            render_scrollbar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(frame, scrollbar_area, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scrollbar_state, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ScrollbarColors</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from_theme</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(theme));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        ScrollablePanelLayout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            content_area,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            scrollbar_area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scroll</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">needs_scrollbar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                Some</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Rect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content_area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">width, area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">y, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">height))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                None</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            item_layouts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> layouts,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Delegate scroll operations</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> scroll_up</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;mut</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, rows</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scroll</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scroll_by</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rows </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> i16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)); }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> scroll_down</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;mut</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, rows</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> u16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scroll</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scroll_by</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rows </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> i16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> scroll_to_ratio</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;mut</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ratio</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> f32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scroll</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scroll_to_ratio</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ratio); }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// Layout info returned by ScrollablePanel::render</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ScrollablePanelLayout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">L</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Content area (excluding scrollbar)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content_area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Rect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Scrollbar area (if visible)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scrollbar_area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Rect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Per-item layouts with their indices</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item_layouts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Vec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">usize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">L</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)&gt;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="handling-oversized-items" tabindex="-1">Handling Oversized Items <a class="header-anchor" href="#handling-oversized-items" aria-label="Permalink to &quot;Handling Oversized Items&quot;">​</a></h3><p>When an item is taller than the viewport (e.g., a TextList with 20 rows):</p><ol><li><strong>Show top on first focus</strong>: When navigating to an oversized item, show its top</li><li><strong>Sub-focus tracking</strong>: Track which internal region is focused</li><li><strong>Scroll within item</strong>: Use <code>ensure_visible()</code> with sub-focus region</li></ol><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Example: TextList with 10 visible rows, user focuses row 15</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">panel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ensure_focused_visible</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">items,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    focused_item_idx,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Some</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Sub-focus: row 15 within the TextList</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// This scrolls to show row 15, even if the TextList item is only partially visible</span></span></code></pre></div><h3 id="integration-with-settings-ui" tabindex="-1">Integration with Settings UI <a class="header-anchor" href="#integration-with-settings-ui" aria-label="Permalink to &quot;Integration with Settings UI&quot;">​</a></h3><p>The settings panel would use <code>ScrollablePanel</code> like this:</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">impl</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SettingsState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> render_settings_panel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;mut</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, frame</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;mut</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Frame</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, area</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Rect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, theme</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Theme</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> page </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">current_page</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unwrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Update content height</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scroll_panel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update_content_height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">page</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">items);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Ensure focused item visible</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> let</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Some</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(selected) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">selected_item {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scroll_panel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ensure_focused_visible</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">page</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">items,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                selected,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sub_focus, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// For TextList/Map internal focus</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Render</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> layout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scroll_panel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            frame,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            area,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">page</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">items,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            |</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">frame, area, item, idx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> render_setting_item</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(frame, area, item, idx, theme),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            theme,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Store layout for hit testing</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">panel_layout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Some</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(layout);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="benefits-1" tabindex="-1">Benefits <a class="header-anchor" href="#benefits-1" aria-label="Permalink to &quot;Benefits&quot;">​</a></h3><ol><li><strong>Reusable</strong>: Same component for settings, file picker, popup lists, etc.</li><li><strong>Row-based scrolling</strong>: Pixel/row precision instead of item-based</li><li><strong>Partial visibility</strong>: Natural handling of items at viewport edges</li><li><strong>Sub-item focus</strong>: Built-in support for navigating within large items</li><li><strong>Consistent behavior</strong>: Same scrolling semantics everywhere</li><li><strong>Testable</strong>: Pure state management can be unit tested</li></ol><h3 id="implementation-plan-1" tabindex="-1">Implementation Plan <a class="header-anchor" href="#implementation-plan-1" aria-label="Permalink to &quot;Implementation Plan&quot;">​</a></h3><ol><li>Create <code>src/view/ui/scroll_panel.rs</code> with <code>ScrollState</code> and <code>ScrollablePanel</code></li><li>Add <code>ScrollItem</code> trait</li><li>Implement <code>ScrollItem</code> for <code>SettingItem</code></li><li>Refactor <code>render_settings_panel</code> to use <code>ScrollablePanel</code></li><li>Add sub-focus support to <code>SettingsState</code> for TextList/Map navigation</li><li>Consider adopting for file picker and popup lists</li></ol><hr><h2 id="future-enhancements" tabindex="-1">Future Enhancements <a class="header-anchor" href="#future-enhancements" aria-label="Permalink to &quot;Future Enhancements&quot;">​</a></h2><ol><li><strong>Project Settings</strong>: Per-project config overrides (<code>.fresh/config.json</code> in project root)</li><li><strong>Settings Profiles</strong>: Named setting profiles (e.g., &quot;Writing&quot;, &quot;Coding&quot;) with quick switching</li><li><strong>Plugin Settings</strong>: Plugin-contributed settings sections via the schema</li><li><strong>Import/Export</strong>: Share settings snippets as JSON</li><li><strong>Search History</strong>: Remember recent searches</li><li><strong>Keyboard Shortcut Editor</strong>: Visual keybinding configuration</li><li><strong>Live Preview</strong>: Immediate application of non-destructive settings</li></ol>`,269)])])}const c=i(e,[["render",l]]);export{g as __pageData,c as default};
