import{_ as i,c as a,o as t,ag as n}from"./chunks/framework.CffQSbY-.js";const g=JSON.parse('{"title":"Input Calibration Wizard Design","description":"","frontmatter":{},"headers":[],"relativePath":"internal/INPUT_CALIBRATION_WIZARD.md","filePath":"internal/INPUT_CALIBRATION_WIZARD.md","lastUpdated":1767475904000}'),e={name:"internal/INPUT_CALIBRATION_WIZARD.md"};function l(h,s,p,k,r,d){return t(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="input-calibration-wizard-design" tabindex="-1">Input Calibration Wizard Design <a class="header-anchor" href="#input-calibration-wizard-design" aria-label="Permalink to &quot;Input Calibration Wizard Design&quot;">​</a></h1><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>The Input Calibration Wizard is a fail-safe feature designed for hostile terminal environments where standard keyboard input may be unreliable. This includes scenarios where:</p><ul><li><code>Enter</code> might send a newline instead of a submit signal</li><li><code>Esc</code> might be trapped by the browser or window manager</li><li><code>Ctrl</code> key combinations might be intercepted by the terminal emulator or OS</li></ul><p>The wizard uses <strong>standard lowercase ASCII characters</strong> (<code>a</code>, <code>s</code>, <code>y</code>, <code>n</code>, <code>r</code>) as control commands because they work on virtually every terminal since 1970.</p><h2 id="problem-statement" tabindex="-1">Problem Statement <a class="header-anchor" href="#problem-statement" aria-label="Permalink to &quot;Problem Statement&quot;">​</a></h2><p>Terminal emulators and environments vary widely in how they handle special keys:</p><ul><li>Web-based terminals (browser-based SSH clients, cloud IDEs)</li><li>Nested terminal sessions (tmux inside SSH inside screen)</li><li>Non-standard terminal emulators</li><li>Accessibility tools that intercept keys</li><li>Virtual machine consoles</li></ul><p>Users in these environments often find that keys like Backspace, Delete, Home, End, or Ctrl+Arrow don&#39;t work as expected. The calibration wizard provides a way to remap these keys to whatever the terminal actually sends.</p><h3 id="relationship-to-kitty-keyboard-protocol" tabindex="-1">Relationship to Kitty Keyboard Protocol <a class="header-anchor" href="#relationship-to-kitty-keyboard-protocol" aria-label="Permalink to &quot;Relationship to Kitty Keyboard Protocol&quot;">​</a></h3><p>Fresh already enables the <strong>Kitty keyboard protocol</strong> (progressive enhancement) via crossterm&#39;s <code>PushKeyboardEnhancementFlags</code>:</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// From main.rs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> keyboard_flags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyboardEnhancementFlags</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DISAMBIGUATE_ESCAPE_CODES</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyboardEnhancementFlags</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">REPORT_ALTERNATE_KEYS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p><strong>When Kitty protocol is supported</strong> (Kitty, WezTerm, foot, etc.):</p><ul><li>Keys are unambiguous (Backspace vs Ctrl+H, Enter vs Ctrl+M)</li><li>Modifier keys are reported precisely</li><li>No calibration needed for most users</li></ul><p><strong>When Kitty protocol is NOT supported</strong> (legacy terminals, web terminals, some SSH clients):</p><ul><li>Falls back to traditional escape sequences</li><li>Ambiguity between keys (0x7F vs 0x08 for backspace)</li><li><strong>This is where the calibration wizard helps</strong></li></ul><p>The calibration wizard is the <strong>fallback</strong> for terminals that don&#39;t support the Kitty protocol. The translation layer sits after crossterm&#39;s parsing, so it works with both Kitty and legacy terminals.</p><h2 id="design-goals" tabindex="-1">Design Goals <a class="header-anchor" href="#design-goals" aria-label="Permalink to &quot;Design Goals&quot;">​</a></h2><ol><li><strong>Absolutely Fail-Safe</strong>: Use only lowercase ASCII letters for navigation/control</li><li><strong>No Dependencies on Problem Keys</strong>: Never require Enter, Esc, or Ctrl to navigate the wizard</li><li><strong>Simple UI</strong>: Plain text rendering that doesn&#39;t require specific terminal capabilities</li><li><strong>Verification Before Save</strong>: Let users test their mappings before committing</li><li><strong>Easy Abort</strong>: Users can always exit without saving changes</li></ol><h2 id="architecture-translation-layer" tabindex="-1">Architecture: Translation Layer <a class="header-anchor" href="#architecture-translation-layer" aria-label="Permalink to &quot;Architecture: Translation Layer&quot;">​</a></h2><p>The calibration system is a <strong>translation layer</strong> that sits between the terminal and the keymap:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────┐     ┌──────────────────┐     ┌───────────────────┐     ┌────────┐</span></span>
<span class="line"><span>│  Terminal   │ ──► │  KeyTranslator   │ ──► │ KeybindingResolver│ ──► │ Action │</span></span>
<span class="line"><span>│ (raw input) │     │  (calibration)   │     │     (keymap)      │     │        │</span></span>
<span class="line"><span>└─────────────┘     └──────────────────┘     └───────────────────┘     └────────┘</span></span>
<span class="line"><span>       │                    │                         │</span></span>
<span class="line"><span>       │                    │                         │</span></span>
<span class="line"><span>  &quot;My terminal         &quot;Normalize to              &quot;Map key to</span></span>
<span class="line"><span>   sends 0x7F&quot;          Backspace&quot;                 action&quot;</span></span></code></pre></div><h3 id="why-a-translation-layer-not-action-overrides" tabindex="-1">Why a Translation Layer (not Action Overrides) <a class="header-anchor" href="#why-a-translation-layer-not-action-overrides" aria-label="Permalink to &quot;Why a Translation Layer (not Action Overrides)&quot;">​</a></h3><p><strong>Option A (Rejected): Override actions directly</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Raw Key → Action</span></span>
<span class="line"><span>0x7F → DeleteBackward</span></span></code></pre></div><p>Problems:</p><ul><li>Bypasses the keymap entirely</li><li>Can&#39;t combine with user keybinding customization</li><li>Different behavior per keybinding map (emacs vs vscode)</li></ul><p><strong>Option B (Chosen): Translate keys, then use keymap</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Raw Key → Normalized Key → Keymap → Action</span></span>
<span class="line"><span>0x7F → Backspace → (keymap lookup) → DeleteBackward</span></span></code></pre></div><p>Benefits:</p><ul><li>Calibration is purely &quot;terminal compatibility&quot;</li><li>Keymap customization still works on top</li><li>Same calibration works with all keybinding maps</li><li>Users can still rebind Backspace to something else if they want</li></ul><h3 id="translation-table-format" tabindex="-1">Translation Table Format <a class="header-anchor" href="#translation-table-format" aria-label="Permalink to &quot;Translation Table Format&quot;">​</a></h3><p>The calibration maps <strong>raw terminal events</strong> to <strong>expected key codes</strong>:</p><table tabindex="0"><thead><tr><th>Raw Event (what terminal sends)</th><th>Expected Key (what Fresh expects)</th></tr></thead><tbody><tr><td><code>Char(&#39;\\x7f&#39;)</code></td><td><code>KeyCode::Backspace</code></td></tr><tr><td><code>Char(&#39;\\x08&#39;)</code></td><td><code>KeyCode::Backspace</code></td></tr><tr><td><code>Alt(&#39;b&#39;)</code></td><td><code>KeyCode::Left</code> + <code>Alt</code> modifier</td></tr><tr><td><code>Esc, &#39;[&#39;, &#39;1&#39;, &#39;~&#39;</code></td><td><code>KeyCode::Home</code></td></tr></tbody></table><p>This translation happens <strong>before</strong> the KeybindingResolver sees the event.</p><h2 id="the-fail-safe-control-scheme" tabindex="-1">The Fail-Safe Control Scheme <a class="header-anchor" href="#the-fail-safe-control-scheme" aria-label="Permalink to &quot;The Fail-Safe Control Scheme&quot;">​</a></h2><p>During the wizard, specific lowercase letters are <strong>reserved commands</strong>:</p><table tabindex="0"><thead><tr><th>Key</th><th>Action</th><th>Description</th></tr></thead><tbody><tr><td><code>s</code></td><td><strong>Skip</strong></td><td>Skip current key calibration (keep default)</td></tr><tr><td><code>g</code></td><td><strong>Skip Group</strong></td><td>Skip all remaining keys in current group</td></tr><tr><td><code>a</code></td><td><strong>Abort</strong></td><td>Exit wizard, discard all changes</td></tr><tr><td><code>y</code></td><td><strong>Yes</strong> / Confirm</td><td>Save settings and exit (verification phase only)</td></tr><tr><td><code>r</code></td><td><strong>Retry</strong></td><td>Restart the wizard from the beginning</td></tr></tbody></table><p><strong>Why these keys are safe to reserve</strong>: The wizard calibrates control keys (Backspace, Delete, Home, End, Alt+Arrow) not alphanumeric keys. It is extremely unlikely that a physical &quot;Home&quot; key sends the letter &quot;s&quot;.</p><h2 id="keys-to-calibrate" tabindex="-1">Keys to Calibrate <a class="header-anchor" href="#keys-to-calibrate" aria-label="Permalink to &quot;Keys to Calibrate&quot;">​</a></h2><p>The wizard calibrates the &quot;problem children&quot; - keys most likely to be broken in hostile terminals. Based on <a href="https://github.com/sinelaw/fresh/issues/219" target="_blank" rel="noreferrer">issue #219</a>, these are organized into categories:</p><h3 id="group-1-basic-editing" tabindex="-1">Group 1: Basic Editing <a class="header-anchor" href="#group-1-basic-editing" aria-label="Permalink to &quot;Group 1: Basic Editing&quot;">​</a></h3><table tabindex="0"><thead><tr><th>#</th><th>Key</th><th>Action</th><th>Common Issues</th></tr></thead><tbody><tr><td>1</td><td><strong>BACKSPACE</strong></td><td>Delete backward</td><td>Sends <code>0x7F</code>, <code>0x08</code>, <code>Delete</code>, or <code>Ctrl+H</code></td></tr><tr><td>2</td><td><strong>DELETE</strong></td><td>Delete forward</td><td>Sometimes confused with Backspace</td></tr><tr><td>3</td><td><strong>TAB</strong></td><td>Indent / Next field</td><td>May be intercepted for completion</td></tr><tr><td>4</td><td><strong>SHIFT + TAB</strong></td><td>Dedent / Prev field</td><td>Modifier combo issues</td></tr></tbody></table><h3 id="group-2-line-navigation" tabindex="-1">Group 2: Line Navigation <a class="header-anchor" href="#group-2-line-navigation" aria-label="Permalink to &quot;Group 2: Line Navigation&quot;">​</a></h3><table tabindex="0"><thead><tr><th>#</th><th>Key</th><th>Action</th><th>Common Issues</th></tr></thead><tbody><tr><td>5</td><td><strong>HOME</strong></td><td>Line start</td><td>Often not forwarded by terminals</td></tr><tr><td>6</td><td><strong>END</strong></td><td>Line end</td><td>Often not forwarded by terminals</td></tr><tr><td>7</td><td><strong>SHIFT + HOME</strong></td><td>Select to line start</td><td>Modifier combo issues</td></tr><tr><td>8</td><td><strong>SHIFT + END</strong></td><td>Select to line end</td><td>Modifier combo issues</td></tr></tbody></table><h3 id="group-3-word-navigation" tabindex="-1">Group 3: Word Navigation <a class="header-anchor" href="#group-3-word-navigation" aria-label="Permalink to &quot;Group 3: Word Navigation&quot;">​</a></h3><table tabindex="0"><thead><tr><th>#</th><th>Key</th><th>Action</th><th>Common Issues</th></tr></thead><tbody><tr><td>9</td><td><strong>ALT + LEFT</strong></td><td>Word left</td><td>Produces special chars on intl keyboards</td></tr><tr><td>10</td><td><strong>ALT + RIGHT</strong></td><td>Word right</td><td>Produces special chars on intl keyboards</td></tr><tr><td>11</td><td><strong>ALT + SHIFT + LEFT</strong></td><td>Select word left</td><td>Modifier combo issues</td></tr><tr><td>12</td><td><strong>ALT + SHIFT + RIGHT</strong></td><td>Select word right</td><td>Modifier combo issues</td></tr><tr><td>13</td><td><strong>CTRL + LEFT</strong></td><td>Word left (alt)</td><td>Alternative for broken Alt</td></tr><tr><td>14</td><td><strong>CTRL + RIGHT</strong></td><td>Word right (alt)</td><td>Alternative for broken Alt</td></tr><tr><td>15</td><td><strong>CTRL + SHIFT + LEFT</strong></td><td>Select word left (alt)</td><td>Alternative for broken Alt</td></tr><tr><td>16</td><td><strong>CTRL + SHIFT + RIGHT</strong></td><td>Select word right (alt)</td><td>Alternative for broken Alt</td></tr></tbody></table><h3 id="group-4-document-navigation" tabindex="-1">Group 4: Document Navigation <a class="header-anchor" href="#group-4-document-navigation" aria-label="Permalink to &quot;Group 4: Document Navigation&quot;">​</a></h3><table tabindex="0"><thead><tr><th>#</th><th>Key</th><th>Action</th><th>Common Issues</th></tr></thead><tbody><tr><td>17</td><td><strong>PAGE UP</strong></td><td>Page up</td><td>Sometimes intercepted</td></tr><tr><td>18</td><td><strong>PAGE DOWN</strong></td><td>Page down</td><td>Sometimes intercepted</td></tr><tr><td>19</td><td><strong>CTRL + HOME</strong></td><td>Document start</td><td>Modifier combo issues</td></tr><tr><td>20</td><td><strong>CTRL + END</strong></td><td>Document end</td><td>Modifier combo issues</td></tr></tbody></table><h3 id="group-5-emacs-style-navigation" tabindex="-1">Group 5: Emacs-Style Navigation <a class="header-anchor" href="#group-5-emacs-style-navigation" aria-label="Permalink to &quot;Group 5: Emacs-Style Navigation&quot;">​</a></h3><table tabindex="0"><thead><tr><th>#</th><th>Key</th><th>Action</th><th>Notes</th></tr></thead><tbody><tr><td>21</td><td><strong>CTRL + A</strong></td><td>Line start</td><td>Emacs-style, useful when Home broken</td></tr><tr><td>22</td><td><strong>CTRL + E</strong></td><td>Line end</td><td>Emacs-style, useful when End broken</td></tr><tr><td>23</td><td><strong>CTRL + K</strong></td><td>Delete to line end</td><td>Emacs kill-line</td></tr><tr><td>24</td><td><strong>CTRL + Y</strong></td><td>Paste (yank)</td><td>Emacs yank, also used for redo</td></tr></tbody></table><p><strong>Total: 24 keys</strong> across 5 groups.</p><p>Users can skip any group with <code>g</code> or any individual key with <code>s</code>.</p><h2 id="user-flow" tabindex="-1">User Flow <a class="header-anchor" href="#user-flow" aria-label="Permalink to &quot;User Flow&quot;">​</a></h2><h3 id="phase-1-capture-loop-steps-1-24" tabindex="-1">Phase 1: Capture Loop (Steps 1-24) <a class="header-anchor" href="#phase-1-capture-loop-steps-1-24" aria-label="Permalink to &quot;Phase 1: Capture Loop (Steps 1-24)&quot;">​</a></h3><p>The UI is stripped down - no fancy boxes that require specific rendering support:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[ FRESH EDITOR INPUT CALIBRATION ]</span></span>
<span class="line"><span>--------------------------------------------------</span></span>
<span class="line"><span>STEP 1 / 24 : Calibrating [ BACKSPACE ]</span></span>
<span class="line"><span>(Group 1: Basic Editing - 1 of 4)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Please press your physical BACKSPACE key now.</span></span>
<span class="line"><span></span></span>
<span class="line"><span> Controls:</span></span>
<span class="line"><span> [ s ] Skip this key (keep default)</span></span>
<span class="line"><span> [ g ] Skip entire group (Basic Editing)</span></span>
<span class="line"><span> [ a ] Abort wizard</span></span>
<span class="line"><span>--------------------------------------------------</span></span>
<span class="line"><span> waiting for input...</span></span></code></pre></div><p><strong>Logic:</strong></p><ol><li>Wait for any key event</li><li><strong>Check for control keys:</strong><ul><li>If <code>key == &#39;s&#39;</code> → Skip to next step</li><li>If <code>key == &#39;g&#39;</code> → Skip all remaining keys in current group, advance to next group</li><li>If <code>key == &#39;a&#39;</code> → Exit wizard, restore original state</li><li>If <code>key == &#39;y&#39;</code>, <code>&#39;n&#39;</code>, or <code>&#39;r&#39;</code> → Block with message: &quot;Reserved key, please press the target key or [s] to skip&quot;</li></ul></li><li><strong>Capture:</strong> Any other key is captured and mapped to the current action</li><li><strong>Auto-advance</strong> to the next step</li></ol><h3 id="phase-2-verification-mode" tabindex="-1">Phase 2: Verification Mode <a class="header-anchor" href="#phase-2-verification-mode" aria-label="Permalink to &quot;Phase 2: Verification Mode&quot;">​</a></h3><p>After capturing all keys, users verify their mappings work:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[ VERIFICATION MODE ]</span></span>
<span class="line"><span>--------------------------------------------------</span></span>
<span class="line"><span>We captured your keys. Let&#39;s test them.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>== Group 1: Basic Editing ==</span></span>
<span class="line"><span> 1. [ BACKSPACE ]:       [   ] Waiting...</span></span>
<span class="line"><span> 2. [ DELETE ]:          [ OK ] Detected!</span></span>
<span class="line"><span> 3. [ TAB ]:             [SKIP] (using default)</span></span>
<span class="line"><span> 4. [ SHIFT+TAB ]:       [SKIP] (using default)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>== Group 2: Line Navigation ==</span></span>
<span class="line"><span> 5. [ HOME ]:            [ OK ] Detected!</span></span>
<span class="line"><span> 6. [ END ]:             [ OK ] Detected!</span></span>
<span class="line"><span> 7. [ SHIFT+HOME ]:      [   ] Waiting...</span></span>
<span class="line"><span> 8. [ SHIFT+END ]:       [   ] Waiting...</span></span>
<span class="line"><span></span></span>
<span class="line"><span>== Group 3: Word Navigation ==</span></span>
<span class="line"><span> 9. [ ALT+LEFT ]:        [ OK ] Detected!</span></span>
<span class="line"><span>10. [ ALT+RIGHT ]:       [ OK ] Detected!</span></span>
<span class="line"><span>    ... (8 more keys)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>== Group 4: Document Navigation == (group skipped)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>== Group 5: Emacs-Style == (group skipped)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>--------------------------------------------------</span></span>
<span class="line"><span>COMMANDS:</span></span>
<span class="line"><span> [ y ] SAVE these settings and exit</span></span>
<span class="line"><span> [ r ] RETRY (restart wizard from beginning)</span></span>
<span class="line"><span> [ a ] ABORT (discard all changes)</span></span></code></pre></div><p><strong>Logic:</strong></p><ul><li>User can press each mapped key to verify it works</li><li>UI updates each line to show <code>[ OK ]</code> when the correct input is detected</li><li>User presses <code>y</code> to save and exit</li></ul><h2 id="integration-points" tabindex="-1">Integration Points <a class="header-anchor" href="#integration-points" aria-label="Permalink to &quot;Integration Points&quot;">​</a></h2><h3 id="_1-cli-parameter" tabindex="-1">1. CLI Parameter <a class="header-anchor" href="#_1-cli-parameter" aria-label="Permalink to &quot;1. CLI Parameter&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fresh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --calibrate</span></span></code></pre></div><p>Launches the editor directly into the calibration wizard. This is useful for first-time setup or when the terminal is so broken that the user can&#39;t navigate to the menu.</p><h3 id="_2-command-palette" tabindex="-1">2. Command Palette <a class="header-anchor" href="#_2-command-palette" aria-label="Permalink to &quot;2. Command Palette&quot;">​</a></h3><ul><li><strong>Command Name</strong>: &quot;Calibrate Input Keys&quot;</li><li><strong>Description</strong>: &quot;Open the input calibration wizard for problematic terminals&quot;</li><li><strong>Action</strong>: <code>Action::CalibrateInput</code></li><li><strong>Contexts</strong>: Available globally (empty contexts)</li></ul><h3 id="_3-menu-item" tabindex="-1">3. Menu Item <a class="header-anchor" href="#_3-menu-item" aria-label="Permalink to &quot;3. Menu Item&quot;">​</a></h3><p>Add to the <strong>View</strong> menu (near Settings):</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>View</span></span>
<span class="line"><span>├── ...</span></span>
<span class="line"><span>├── Settings</span></span>
<span class="line"><span>├── Calibrate Input Keys...</span></span>
<span class="line"><span>├── ───────────</span></span>
<span class="line"><span>└── ...</span></span></code></pre></div><h2 id="state-machine" tabindex="-1">State Machine <a class="header-anchor" href="#state-machine" aria-label="Permalink to &quot;State Machine&quot;">​</a></h2><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> crossterm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">KeyCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">KeyModifiers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">KeyEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CalibrationStep</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Capturing key for a specific target</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Capture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        group_idx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> usize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Index into CALIBRATION_GROUPS</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        key_idx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> usize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Index into group&#39;s key list</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Verification phase</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Verify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// What the user&#39;s key SHOULD produce (the expected/normalized key)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// What Fresh expects to receive</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CalibrationGroup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> targets</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 5 groups, 24 keys total</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CALIBRATION_GROUPS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CalibrationGroup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Group 1: Basic Editing (4 keys)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    CalibrationGroup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Basic Editing&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        targets</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;BACKSPACE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Backspace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NONE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;DELETE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NONE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;TAB&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Tab</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NONE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;SHIFT+TAB&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BackTab</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SHIFT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Group 2: Line Navigation (4 keys)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    CalibrationGroup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Line Navigation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        targets</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;HOME&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Home</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NONE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;END&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">End</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NONE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;SHIFT+HOME&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Home</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SHIFT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;SHIFT+END&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">End</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SHIFT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Group 3: Word Navigation (8 keys)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    CalibrationGroup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Word Navigation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        targets</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ALT+LEFT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Left</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ALT+RIGHT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Right</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ALT+SHIFT+LEFT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Left</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SHIFT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ALT+SHIFT+RIGHT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Right</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SHIFT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;CTRL+LEFT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Left</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONTROL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;CTRL+RIGHT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Right</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONTROL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;CTRL+SHIFT+LEFT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Left</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONTROL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SHIFT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;CTRL+SHIFT+RIGHT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Right</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONTROL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SHIFT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Group 4: Document Navigation (4 keys)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    CalibrationGroup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Document Navigation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        targets</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;PAGE UP&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PageUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NONE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;PAGE DOWN&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PageDown</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NONE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;CTRL+HOME&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Home</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONTROL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;CTRL+END&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">End</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONTROL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Group 5: Emacs-Style Navigation (4 keys)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    CalibrationGroup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Emacs-Style&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        targets</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;CTRL+A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;a&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONTROL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;CTRL+E&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;e&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONTROL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;CTRL+K&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;k&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONTROL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            CalibrationTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;CTRL+Y&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, expected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExpectedKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;y&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), modifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyModifiers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONTROL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CalibrationWizard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Current step</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    step</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CalibrationStep</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Translation table: raw terminal event → expected normalized event</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Key: what the terminal actually sends</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Value: what Fresh expects (the &quot;correct&quot; key)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pending_translations</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HashMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">KeyEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">KeyEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Which keys have been verified in the verification phase</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verified</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HashSet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">usize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Index into flattened key list</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Groups that were skipped entirely</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    skipped_groups</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HashSet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">usize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// The key translator that applies calibration</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyTranslator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Translation table loaded from config</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    translations</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HashMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">KeyEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">KeyEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">impl</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyTranslator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Translate a raw terminal event to a normalized event</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> translate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, raw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KeyEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">translations</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">raw)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cloned</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unwrap_or</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(raw)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="configuration-storage" tabindex="-1">Configuration Storage <a class="header-anchor" href="#configuration-storage" aria-label="Permalink to &quot;Configuration Storage&quot;">​</a></h2><p>When the user presses <code>y</code> to save, mappings are written to <code>~/.config/fresh/key_calibration.json</code>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;_comment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Generated by &#39;Calibrate Input Keys&#39; wizard&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;_format&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;raw_key → expected_key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;translations&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;Char(0x7f)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Backspace&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;Char(0x08)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Backspace&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;Alt(b)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Alt+Left&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;Esc,[,1,~&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Home&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Keys not listed use default behavior (no translation).</p><h3 id="processing-order" tabindex="-1">Processing Order <a class="header-anchor" href="#processing-order" aria-label="Permalink to &quot;Processing Order&quot;">​</a></h3><p>The translation layer runs <strong>before</strong> keybinding resolution:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. Terminal sends raw KeyEvent</span></span>
<span class="line"><span>2. KeyTranslator.translate(raw) → normalized KeyEvent  ← CALIBRATION</span></span>
<span class="line"><span>3. KeybindingResolver.resolve(normalized) → Action     ← KEYMAP</span></span>
<span class="line"><span>4. Editor executes Action</span></span></code></pre></div><p>This means:</p><ul><li>Calibration is loaded once at startup (or reloaded after wizard saves)</li><li>Keybindings still work normally on the normalized keys</li><li>User can customize keybindings independently of calibration</li></ul><h2 id="file-structure" tabindex="-1">File Structure <a class="header-anchor" href="#file-structure" aria-label="Permalink to &quot;File Structure&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>src/</span></span>
<span class="line"><span>├── input/</span></span>
<span class="line"><span>│   ├── keybindings.rs           # Add CalibrateInput action</span></span>
<span class="line"><span>│   ├── key_translator.rs        # NEW: KeyTranslator + load/save calibration</span></span>
<span class="line"><span>│   └── mod.rs                   # Wire translator into input pipeline</span></span>
<span class="line"><span>├── app/</span></span>
<span class="line"><span>│   ├── calibration_wizard.rs    # NEW: Wizard state machine and logic</span></span>
<span class="line"><span>│   └── mod.rs                   # Integration with Editor</span></span>
<span class="line"><span>└── view/</span></span>
<span class="line"><span>    └── ui/</span></span>
<span class="line"><span>        └── calibration_ui.rs    # NEW: Wizard UI rendering</span></span></code></pre></div><h2 id="implementation-plan" tabindex="-1">Implementation Plan <a class="header-anchor" href="#implementation-plan" aria-label="Permalink to &quot;Implementation Plan&quot;">​</a></h2><h3 id="phase-1-core-infrastructure" tabindex="-1">Phase 1: Core Infrastructure <a class="header-anchor" href="#phase-1-core-infrastructure" aria-label="Permalink to &quot;Phase 1: Core Infrastructure&quot;">​</a></h3><ol><li>Add <code>Action::CalibrateInput</code> to keybindings.rs</li><li>Add command to commands.rs</li><li>Add CLI parameter <code>--calibrate</code> to main.rs</li><li>Add menu item to View menu</li><li>Add i18n strings</li></ol><h3 id="phase-2-translation-layer" tabindex="-1">Phase 2: Translation Layer <a class="header-anchor" href="#phase-2-translation-layer" aria-label="Permalink to &quot;Phase 2: Translation Layer&quot;">​</a></h3><ol start="6"><li>Create <code>KeyTranslator</code> struct with <code>translate()</code> method</li><li>Implement loading from <code>key_calibration.json</code></li><li>Wire translator into main event loop (before keymap resolution)</li></ol><h3 id="phase-3-wizard-logic" tabindex="-1">Phase 3: Wizard Logic <a class="header-anchor" href="#phase-3-wizard-logic" aria-label="Permalink to &quot;Phase 3: Wizard Logic&quot;">​</a></h3><ol start="9"><li>Create <code>CalibrationWizard</code> state machine</li><li>Implement capture phase input handling</li><li>Implement verification phase input handling</li><li>Integrate with Editor (modal state)</li></ol><h3 id="phase-4-persistence-ui" tabindex="-1">Phase 4: Persistence &amp; UI <a class="header-anchor" href="#phase-4-persistence-ui" aria-label="Permalink to &quot;Phase 4: Persistence &amp; UI&quot;">​</a></h3><ol start="13"><li>Implement key_calibration.json writing</li><li>Implement reload after wizard saves</li><li>Implement capture phase UI rendering</li><li>Implement verification phase UI rendering</li><li>Add status messages and error handling</li></ol><h2 id="security-considerations" tabindex="-1">Security Considerations <a class="header-anchor" href="#security-considerations" aria-label="Permalink to &quot;Security Considerations&quot;">​</a></h2><ul><li>The wizard only remaps navigation/editing keys, not commands that could execute actions</li><li>No file system access beyond the config directory</li><li>No network access</li><li>Abort (<code>a</code>) always works and discards all changes</li></ul><h2 id="accessibility" tabindex="-1">Accessibility <a class="header-anchor" href="#accessibility" aria-label="Permalink to &quot;Accessibility&quot;">​</a></h2><ul><li>All controls are single lowercase letters</li><li>No timing requirements (wizard waits indefinitely)</li><li>Clear text prompts with no color-dependent information</li><li>Screen reader compatible (plain text UI)</li></ul><h2 id="testing-strategy" tabindex="-1">Testing Strategy <a class="header-anchor" href="#testing-strategy" aria-label="Permalink to &quot;Testing Strategy&quot;">​</a></h2><ol><li><strong>Unit tests</strong>: State machine transitions, key capture logic</li><li><strong>Integration tests</strong>: Full wizard flow with mock input</li><li><strong>E2E tests</strong>: CLI parameter, menu activation, save/load cycle</li></ol><h2 id="open-questions" tabindex="-1">Open Questions <a class="header-anchor" href="#open-questions" aria-label="Permalink to &quot;Open Questions&quot;">​</a></h2><ol><li>Should we detect when a user&#39;s terminal seems &quot;hostile&quot; and suggest the wizard automatically?</li><li>Should the wizard also calibrate Shift+Arrow keys for selection?</li><li>Should there be a &quot;reset to defaults&quot; option in the wizard?</li></ol><h2 id="references" tabindex="-1">References <a class="header-anchor" href="#references" aria-label="Permalink to &quot;References&quot;">​</a></h2><ul><li><a href="https://invisible-island.net/xterm/ctlseqs/ctlseqs.html" target="_blank" rel="noreferrer">Terminal Input Handling</a></li><li><a href="https://en.wikipedia.org/wiki/ANSI_escape_code" target="_blank" rel="noreferrer">ANSI Escape Codes</a></li><li><a href="https://docs.rs/crossterm/latest/crossterm/event/enum.KeyCode.html" target="_blank" rel="noreferrer">Crossterm Key Events</a></li></ul>`,105)])])}const E=i(e,[["render",l]]);export{g as __pageData,E as default};
