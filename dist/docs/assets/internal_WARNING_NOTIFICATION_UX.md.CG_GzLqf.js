import{_ as i,c as a,o as n,ag as t}from"./chunks/framework.CffQSbY-.js";const g=JSON.parse('{"title":"Warning Notification UX Design (Proposed)","description":"","frontmatter":{},"headers":[],"relativePath":"internal/WARNING_NOTIFICATION_UX.md","filePath":"internal/WARNING_NOTIFICATION_UX.md","lastUpdated":1767011992000}'),l={name:"internal/WARNING_NOTIFICATION_UX.md"};function p(e,s,h,r,k,o){return n(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="warning-notification-ux-design-proposed" tabindex="-1">Warning Notification UX Design (Proposed) <a class="header-anchor" href="#warning-notification-ux-design-proposed" aria-label="Permalink to &quot;Warning Notification UX Design (Proposed)&quot;">​</a></h1><p>This document describes the proposed UX for warning notifications, addressing issues #493 and #451 regarding the auto-opening of warning log files.</p><h2 id="problem-statement" tabindex="-1">Problem Statement <a class="header-anchor" href="#problem-statement" aria-label="Permalink to &quot;Problem Statement&quot;">​</a></h2><p>The current implementation auto-opens a warning log file tab when errors or warnings occur (e.g., LSP server not found). This creates several UX issues:</p><ol><li><strong>Unwanted interruption</strong>: A new tab appears without user consent, cluttering the workspace</li><li><strong>Not actionable</strong>: The warning log shows raw error text without suggesting solutions</li><li><strong>No user control</strong>: No way to suppress or configure this behavior</li><li><strong>Repetitive noise</strong>: Same warnings repeat endlessly in the log (e.g., &quot;Failed to send didChange&quot;)</li></ol><h3 id="current-behavior" tabindex="-1">Current Behavior <a class="header-anchor" href="#current-behavior" aria-label="Permalink to &quot;Current Behavior&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>User opens .py file (pylsp not installed)</span></span>
<span class="line"><span>         |</span></span>
<span class="line"><span>         v</span></span>
<span class="line"><span>Tab auto-opens: fresh-warnings-XXXX.log</span></span>
<span class="line"><span>Status bar shows: &quot;Warnings detected - see log&quot;</span></span>
<span class="line"><span>         |</span></span>
<span class="line"><span>         v</span></span>
<span class="line"><span>User must manually close unwanted tab</span></span></code></pre></div><p>Warning log content (repetitive, not actionable):</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>2025-12-27 19:18:30.960 ERROR: Failed to spawn LSP: &#39;pylsp&#39; not found</span></span>
<span class="line"><span>2025-12-27 19:18:30.960 WARN: Failed to send didChange to LSP</span></span>
<span class="line"><span>2025-12-27 19:18:30.961 WARN: Failed to send didChange to LSP  &lt;- repeats</span></span>
<span class="line"><span>2025-12-27 19:18:30.962 WARN: Failed to send didChange to LSP  &lt;- repeats</span></span>
<span class="line"><span>...</span></span></code></pre></div><h2 id="design-principles" tabindex="-1">Design Principles <a class="header-anchor" href="#design-principles" aria-label="Permalink to &quot;Design Principles&quot;">​</a></h2><p>Based on NNGroup usability heuristics:</p><ol><li><strong>User Control and Freedom</strong>: User decides when to see details, not the system</li><li><strong>Progressive Disclosure</strong>: Badge -&gt; Click -&gt; Details -&gt; Full log</li><li><strong>Recognition over Recall</strong>: Visual indicators (color, icons) are quickly scannable</li><li><strong>Aesthetic and Minimalist Design</strong>: Show only what&#39;s needed, when needed</li><li><strong>Help Users Recover from Errors</strong>: Provide actionable solutions, not just error text</li></ol><p><strong>Core principle</strong>: The editor respects that the user is trying to edit text. Warnings are available, not pushed.</p><h2 id="proposed-solution" tabindex="-1">Proposed Solution <a class="header-anchor" href="#proposed-solution" aria-label="Permalink to &quot;Proposed Solution&quot;">​</a></h2><h3 id="two-tier-notification-system" tabindex="-1">Two-Tier Notification System <a class="header-anchor" href="#two-tier-notification-system" aria-label="Permalink to &quot;Two-Tier Notification System&quot;">​</a></h3><p><strong>Tier 1: Visual Indicator (Non-Intrusive)</strong></p><ul><li>Colored background segment in status bar</li><li>No popup, no tab, no modal</li><li>User can completely ignore if they don&#39;t care</li></ul><p><strong>Tier 2: Actionable Popup (User-Initiated)</strong></p><ul><li>Appears only when user clicks the indicator</li><li>Shows grouped/deduplicated warnings</li><li>Provides actionable solutions (e.g., install commands for LSP)</li><li>Transient - dismisses on click outside or Escape</li></ul><h3 id="status-bar-visual-states" tabindex="-1">Status Bar Visual States <a class="header-anchor" href="#status-bar-visual-states" aria-label="Permalink to &quot;Status Bar Visual States&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Normal (no issues):</span></span>
<span class="line"><span>+-----------------------------------------------------------------------------+</span></span>
<span class="line"><span>| test.py | Ln 1, Col 0 | LSP [python]                         Palette: Ctrl+P|</span></span>
<span class="line"><span>+-----------------------------------------------------------------------------+</span></span>
<span class="line"><span></span></span>
<span class="line"><span>LSP not configured (silent - user doesn&#39;t care about LSP):</span></span>
<span class="line"><span>+-----------------------------------------------------------------------------+</span></span>
<span class="line"><span>| test.py | Ln 1, Col 0                                        Palette: Ctrl+P|</span></span>
<span class="line"><span>+-----------------------------------------------------------------------------+</span></span>
<span class="line"><span></span></span>
<span class="line"><span>LSP warning (noticeable but non-intrusive):</span></span>
<span class="line"><span>+-----------------------------------------------------------------------------+</span></span>
<span class="line"><span>| test.py | Ln 1, Col 0 |##LSP [python]##|                     Palette: Ctrl+P|</span></span>
<span class="line"><span>+-----------------------------------------------------------------------------+</span></span>
<span class="line"><span>                         ^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>                         Amber/yellow background</span></span>
<span class="line"><span>                         Visually distinct, not demanding</span></span>
<span class="line"><span></span></span>
<span class="line"><span>LSP error (more prominent):</span></span>
<span class="line"><span>+-----------------------------------------------------------------------------+</span></span>
<span class="line"><span>| test.py | Ln 1, Col 0 |@@LSP [python]@@|                     Palette: Ctrl+P|</span></span>
<span class="line"><span>+-----------------------------------------------------------------------------+</span></span>
<span class="line"><span>                         ^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>                         Red background</span></span></code></pre></div><h3 id="initial-appearance-animation" tabindex="-1">Initial Appearance Animation <a class="header-anchor" href="#initial-appearance-animation" aria-label="Permalink to &quot;Initial Appearance Animation&quot;">​</a></h3><p>When a warning first occurs, use a brief visual pulse to catch the user&#39;s peripheral vision:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>T=0 (error occurs):     [### BRIGHT/INVERTED ###]   &lt;- Eye-catching</span></span>
<span class="line"><span>T=1s:                   [## Fading... ##]           &lt;- Settling</span></span>
<span class="line"><span>T=2s:                   [# Steady state #]          &lt;- Persistent subtle bg</span></span></code></pre></div><p>This ensures the user notices without demanding immediate attention.</p><h3 id="user-clicks-indicator-contextual-popup" tabindex="-1">User Clicks Indicator -&gt; Contextual Popup <a class="header-anchor" href="#user-clicks-indicator-contextual-popup" aria-label="Permalink to &quot;User Clicks Indicator -&gt; Contextual Popup&quot;">​</a></h3><p>Only when user explicitly clicks the status bar segment or presses keybinding:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>+-----------------------------------------------------------------------------+</span></span>
<span class="line"><span>| test.py x                                                                   |</span></span>
<span class="line"><span>|-----------------------------------------------------------------------------|</span></span>
<span class="line"><span>|    1 | print(&quot;hello&quot;)                                                       |</span></span>
<span class="line"><span>|~                                                                            |</span></span>
<span class="line"><span>|~                          +-- Python LSP ------------------+                |</span></span>
<span class="line"><span>|~                          |                                |                |</span></span>
<span class="line"><span>|~                          | [!] Server &#39;pylsp&#39; not found   |                |</span></span>
<span class="line"><span>|~                          |                                |                |</span></span>
<span class="line"><span>|~                          | Install:                       |                |</span></span>
<span class="line"><span>|~                          | pip install python-lsp-server  |                |</span></span>
<span class="line"><span>|~                          |                       [Copy]   |                |</span></span>
<span class="line"><span>|~                          |                                |                |</span></span>
<span class="line"><span>|~                          | [Disable Python LSP] [Dismiss] |                |</span></span>
<span class="line"><span>|~                          +--------------------------------+                |</span></span>
<span class="line"><span>|~                                                                            |</span></span>
<span class="line"><span>|-----------------------------------------------------------------------------|</span></span>
<span class="line"><span>| test.py | Ln 1, Col 0 |##LSP [python]##|                     Palette: Ctrl+P|</span></span>
<span class="line"><span>+-----------------------------------------------------------------------------+</span></span></code></pre></div><p><strong>Popup characteristics:</strong></p><ul><li>Transient: clicking outside or pressing Escape dismisses it</li><li>Actionable: shows install command with Copy button</li><li>Escape hatch: &quot;Disable LSP&quot; button for users who don&#39;t want LSP</li><li>No &quot;Don&#39;t show again&quot; needed - the design is already non-intrusive</li></ul><h3 id="generic-warnings-non-lsp" tabindex="-1">Generic Warnings (Non-LSP) <a class="header-anchor" href="#generic-warnings-non-lsp" aria-label="Permalink to &quot;Generic Warnings (Non-LSP)&quot;">​</a></h3><p>For other warning types, similar pattern with warning count badge:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Status bar:</span></span>
<span class="line"><span>+-----------------------------------------------------------------------------+</span></span>
<span class="line"><span>| test.py | Ln 1, Col 0 |##[!] 2##|                            Palette: Ctrl+P|</span></span>
<span class="line"><span>+-----------------------------------------------------------------------------+</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Click -&gt; popup:</span></span>
<span class="line"><span>+-- Warnings (2) ---------------+</span></span>
<span class="line"><span>| * Failed to load plugin X     |</span></span>
<span class="line"><span>| * Theme file not found        |</span></span>
<span class="line"><span>|                               |</span></span>
<span class="line"><span>| [View Full Log]    [Dismiss]  |</span></span>
<span class="line"><span>+-------------------------------+</span></span></code></pre></div><p><code>[View Full Log]</code> opens the warning file in a new tab - <strong>user-initiated</strong>, not automatic.</p><h2 id="generic-warning-domain-architecture" tabindex="-1">Generic Warning Domain Architecture <a class="header-anchor" href="#generic-warning-domain-architecture" aria-label="Permalink to &quot;Generic Warning Domain Architecture&quot;">​</a></h2><p>The warning system is designed to be extensible, allowing different subsystems (LSP, plugins, config, etc.) to register their own warning domains with custom popup content.</p><h3 id="warningdomain-trait" tabindex="-1">WarningDomain Trait <a class="header-anchor" href="#warningdomain-trait" aria-label="Permalink to &quot;WarningDomain Trait&quot;">​</a></h3><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// A domain that can report warnings/errors with custom popups</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> trait</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WarningDomain</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Send</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Sync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Domain identifier (e.g., &quot;lsp&quot;, &quot;plugin&quot;, &quot;config&quot;)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Display label for status bar (e.g., &quot;LSP [python]&quot;, &quot;Plugins&quot;)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> label</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Current warning level</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> level</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WarningLevel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Content for popup when user clicks the indicator</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> popup_content</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WarningPopupContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WarningPopupContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> title</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Supports markdown</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> actions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Vec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WarningAction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WarningAction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> label</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> action_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// e.g., &quot;copy_install_cmd&quot;, &quot;disable_lsp&quot;, &quot;view_log&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="status-bar-with-multiple-domains" tabindex="-1">Status Bar with Multiple Domains <a class="header-anchor" href="#status-bar-with-multiple-domains" aria-label="Permalink to &quot;Status Bar with Multiple Domains&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Multiple warning sources:</span></span>
<span class="line"><span>+-----------------------------------------------------------------------------+</span></span>
<span class="line"><span>| file.py | Ln 1, Col 5 | LSP [python: ⚠] | [⚠ 2] |           Palette: Ctrl+P |</span></span>
<span class="line"><span>+-----------------------------------------------------------------------------+</span></span>
<span class="line"><span>                         ^^^^^^^^^^^^^^^^^   ^^^^^^</span></span>
<span class="line"><span>                         LSP domain          General warnings</span></span>
<span class="line"><span>                         (amber bg)          (amber bg)</span></span></code></pre></div><h3 id="domain-registration" tabindex="-1">Domain Registration <a class="header-anchor" href="#domain-registration" aria-label="Permalink to &quot;Domain Registration&quot;">​</a></h3><p>Built-in domains are registered at startup:</p><ul><li><code>LspWarningDomain</code> - LSP server errors/warnings</li><li><code>GeneralWarningDomain</code> - Catch-all for other logged warnings</li></ul><p>Plugins can register additional domains via the plugin API.</p><h3 id="benefits" tabindex="-1">Benefits <a class="header-anchor" href="#benefits" aria-label="Permalink to &quot;Benefits&quot;">​</a></h3><ol><li><strong>Extensible</strong> - Plugins can add their own warning indicators</li><li><strong>Consistent UX</strong> - All warnings follow same pattern (colored badge → click → popup)</li><li><strong>Domain-specific actions</strong> - LSP shows install commands, plugins show disable option</li><li><strong>Decoupled</strong> - Each domain manages its own state and popup content</li></ol><h2 id="plugin-architecture-for-lsp-install-helpers" tabindex="-1">Plugin Architecture for LSP Install Helpers <a class="header-anchor" href="#plugin-architecture-for-lsp-install-helpers" aria-label="Permalink to &quot;Plugin Architecture for LSP Install Helpers&quot;">​</a></h2><p>LSP installation helpers are fully plugin-based, allowing different plugins for different languages.</p><h3 id="required-hooks-core-→-plugin" tabindex="-1">Required Hooks (Core → Plugin) <a class="header-anchor" href="#required-hooks-core-→-plugin" aria-label="Permalink to &quot;Required Hooks (Core → Plugin)&quot;">​</a></h3><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// In src/services/plugins/hooks.rs</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// LSP server failed to start</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LspServerError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// The language that failed (e.g., &quot;python&quot;, &quot;rust&quot;)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    language</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// The server command that failed (e.g., &quot;pylsp&quot;, &quot;rust-analyzer&quot;)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    server_command</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Error type: &quot;not_found&quot;, &quot;spawn_failed&quot;, &quot;timeout&quot;, &quot;crash&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    error_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Human-readable error message</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// User clicked the LSP status indicator in the status bar</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LspStatusClicked</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// The language of the current buffer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    language</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Whether there&#39;s an active error</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    has_error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// User selected an action from an action popup</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ActionPopupResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// The popup ID (set when showing popup)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    popup_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// The action ID selected, or &quot;dismissed&quot; if closed without selection</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    action_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="required-api-plugin-→-core" tabindex="-1">Required API (Plugin → Core) <a class="header-anchor" href="#required-api-plugin-→-core" aria-label="Permalink to &quot;Required API (Plugin → Core)&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// New API additions to fresh.d.ts</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ActionPopupAction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Unique action identifier</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  label</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Display text (can include install command)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ActionPopupOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;                    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Popup identifier for ActionPopupResult</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  title</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;                 </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Popup title</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;               </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Body text (supports basic formatting)</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  actions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ActionPopupAction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[];  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Action buttons</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Show an action popup (user must click an action or dismiss)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fresh.ui.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">showActionPopup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(options: ActionPopupOptions): </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Disable LSP for a specific language (persists to config)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fresh.lsp.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">disableForLanguage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(language: string): </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Existing API (already implemented):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fresh.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setClipboard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text: string): </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fresh.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(message: string): </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h3 id="example-python-lsp-helper-plugin" tabindex="-1">Example: Python LSP Helper Plugin <a class="header-anchor" href="#example-python-lsp-helper-plugin" aria-label="Permalink to &quot;Example: Python LSP Helper Plugin&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// plugins/python-lsp.ts</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Users can create similar plugins for any language</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> INSTALL_COMMANDS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  pip: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pip install python-lsp-server&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  pipx: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pipx install python-lsp-server&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  pip_all: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pip install &#39;python-lsp-server[all]&#39;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Track error state</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pythonLspError</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">serverCommand</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Listen for LSP errors</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fresh.hooks.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;lspServerError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (event.language </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;python&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pythonLspError </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      serverCommand: event.serverCommand,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      message: event.message,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Handle status bar click</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fresh.hooks.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;lspStatusClicked&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (event.language </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;python&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pythonLspError) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  fresh.ui.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">showActionPopup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;python-lsp-help&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Python LSP Error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    message: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`Server &#39;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pythonLspError</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serverCommand</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&#39; not found.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Install with one of these commands:\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    actions: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      { id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;copy_pip&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, label: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`Copy: \${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INSTALL_COMMANDS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      { id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;copy_pipx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, label: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`Copy: \${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INSTALL_COMMANDS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pipx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      { id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;disable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, label: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Disable Python LSP&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      { id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;dismiss&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, label: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Dismiss&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Handle action selection</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fresh.hooks.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;actionPopupResult&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (event.popup_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;python-lsp-help&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  switch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (event.action_id) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;copy_pip&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      fresh.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setClipboard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INSTALL_COMMANDS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.pip);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      fresh.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Copied: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> INSTALL_COMMANDS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.pip);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;copy_pipx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      fresh.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setClipboard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INSTALL_COMMANDS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.pipx);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      fresh.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Copied: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> INSTALL_COMMANDS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.pipx);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;disable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      fresh.lsp.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">disableForLanguage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;python&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      fresh.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Python LSP disabled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      pythonLspError </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h3 id="plugin-distribution" tabindex="-1">Plugin Distribution <a class="header-anchor" href="#plugin-distribution" aria-label="Permalink to &quot;Plugin Distribution&quot;">​</a></h3><p>Each language can have its own plugin file:</p><ul><li><code>plugins/python-lsp.ts</code> - Python LSP helper (bundled)</li><li><code>plugins/rust-lsp.ts</code> - Rust LSP helper (bundled)</li><li><code>plugins/typescript-lsp.ts</code> - TypeScript LSP helper (bundled)</li><li><code>~/.config/fresh/plugins/go-lsp.ts</code> - User-created Go helper</li></ul><p>This allows:</p><ol><li><strong>Language-specific behavior</strong> - Each plugin knows its ecosystem (pip vs npm vs cargo)</li><li><strong>User extensibility</strong> - Users add plugins for languages we don&#39;t bundle</li><li><strong>Community sharing</strong> - Plugins can be shared independently</li><li><strong>No core changes</strong> - Adding new language support doesn&#39;t require editor changes</li></ol><h2 id="theme-colors" tabindex="-1">Theme Colors <a class="header-anchor" href="#theme-colors" aria-label="Permalink to &quot;Theme Colors&quot;">​</a></h2><p>Add warning indicator colors to the theme system:</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// In src/view/theme.rs</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Theme</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... existing fields ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Background for warning indicators (amber/yellow)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> warning_indicator_bg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Foreground for warning indicators</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> warning_indicator_fg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Background for error indicators (red)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error_indicator_bg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /// Foreground for error indicators</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error_indicator_fg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Default values (work on both dark and light themes):</p><ul><li>Warning: <code>#B58900</code> background (amber), <code>#000000</code> foreground</li><li>Error: <code>#DC322F</code> background (red), <code>#FFFFFF</code> foreground</li></ul><h2 id="settings" tabindex="-1">Settings <a class="header-anchor" href="#settings" aria-label="Permalink to &quot;Settings&quot;">​</a></h2><p>Minimal settings - the design is already non-intrusive:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;warnings&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;show_status_indicator&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // default: true, can disable entirely</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>No complex per-warning suppression needed because nothing is intrusive.</p><h2 id="interaction-flow" tabindex="-1">Interaction Flow <a class="header-anchor" href="#interaction-flow" aria-label="Permalink to &quot;Interaction Flow&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>User opens .py file</span></span>
<span class="line"><span>         |</span></span>
<span class="line"><span>         v</span></span>
<span class="line"><span>    LSP init fails</span></span>
<span class="line"><span>         |</span></span>
<span class="line"><span>         v</span></span>
<span class="line"><span>Update status bar: colored [python] segment</span></span>
<span class="line"><span>Store install helper info in state</span></span>
<span class="line"><span>         |</span></span>
<span class="line"><span>         v</span></span>
<span class="line"><span>      DONE  &lt;-- No popup, no tab, no modal</span></span>
<span class="line"><span>                User continues editing uninterrupted</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>User notices colored indicator later</span></span>
<span class="line"><span>         |</span></span>
<span class="line"><span>         v</span></span>
<span class="line"><span>Clicks indicator (or presses Ctrl+Shift+L)</span></span>
<span class="line"><span>         |</span></span>
<span class="line"><span>         v</span></span>
<span class="line"><span>+---------------------------+</span></span>
<span class="line"><span>| Transient popup appears   |</span></span>
<span class="line"><span>| with:                     |</span></span>
<span class="line"><span>| * Error explanation       |</span></span>
<span class="line"><span>| * Install command + Copy  |</span></span>
<span class="line"><span>| * [Disable LSP] button    |</span></span>
<span class="line"><span>+---------------------------+</span></span>
<span class="line"><span>         |</span></span>
<span class="line"><span>         v</span></span>
<span class="line"><span>User takes action or dismisses</span></span>
<span class="line"><span>         |</span></span>
<span class="line"><span>         v</span></span>
<span class="line"><span>Popup closes, user continues editing</span></span></code></pre></div><h2 id="files-to-modify" tabindex="-1">Files to Modify <a class="header-anchor" href="#files-to-modify" aria-label="Permalink to &quot;Files to Modify&quot;">​</a></h2><ol><li><strong><code>src/config.rs</code></strong> - Add <code>warnings.show_status_indicator</code> setting</li><li><strong><code>src/services/warning_log.rs</code></strong> - Add warning deduplication, remove auto-open trigger</li><li><strong><code>src/app/mod.rs</code></strong> - Replace <code>check_warning_log()</code> auto-open with state update</li><li><strong><code>src/view/ui/status_bar.rs</code></strong> - Add colored warning segment rendering with animation</li><li><strong><code>src/view/theme.rs</code></strong> - Add <code>warning_indicator_*</code> and <code>error_indicator_*</code> colors</li><li><strong><code>src/services/plugins/hooks.rs</code></strong> - Add <code>LspInitError</code> hook</li><li><strong><code>src/view/popup.rs</code></strong> - Add warning popup variant with action buttons</li><li><strong><code>plugins/lsp-install-helper.ts</code></strong> - New bundled plugin for install helpers</li></ol><h2 id="comparison-before-and-after" tabindex="-1">Comparison: Before and After <a class="header-anchor" href="#comparison-before-and-after" aria-label="Permalink to &quot;Comparison: Before and After&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Aspect</th><th>Before</th><th>After</th></tr></thead><tbody><tr><td>Auto-open tab</td><td>Yes (intrusive)</td><td>No</td></tr><tr><td>Modal popup</td><td>N/A</td><td>No</td></tr><tr><td>User interruption</td><td>Every warning</td><td>Never</td></tr><tr><td>Visual indicator</td><td>Text only</td><td>Colored background segment</td></tr><tr><td>Discoverability</td><td>Low (easy to miss status text)</td><td>High (color draws attention)</td></tr><tr><td>Actionability</td><td>None (raw log text)</td><td>Install commands with Copy</td></tr><tr><td>User control</td><td>None</td><td>Click to see, Disable LSP option</td></tr><tr><td>Extensibility</td><td>None</td><td>Plugin-based install helpers</td></tr></tbody></table><h2 id="implementation-status" tabindex="-1">Implementation Status <a class="header-anchor" href="#implementation-status" aria-label="Permalink to &quot;Implementation Status&quot;">​</a></h2><h3 id="completed-✓" tabindex="-1">Completed ✓ <a class="header-anchor" href="#completed-✓" aria-label="Permalink to &quot;Completed ✓&quot;">​</a></h3><ol><li><strong>Status bar colored indicators</strong> - LSP indicator and warning badge with colored backgrounds</li><li><strong>Warning domain architecture</strong> - <code>WarningDomain</code> trait, <code>GeneralWarningDomain</code>, <code>LspWarningDomain</code></li><li><strong>Theme colors</strong> - <code>status_warning_indicator_bg/fg</code>, <code>status_error_indicator_bg/fg</code> + hover variants</li><li><strong>Hover styling</strong> - Lighter colors and underline on hover to indicate clickability</li><li><strong>Warning log deduplication</strong> - Tracks seen warnings to avoid repetitive log entries</li><li><strong>Commands</strong> - <code>ShowWarnings</code>, <code>ShowLspStatus</code>, <code>ClearWarnings</code> via command palette</li><li><strong>Mouse click handlers</strong> - Clicking LSP indicator or warning badge triggers appropriate action</li><li><strong>Settings</strong> - <code>warnings.show_status_indicator</code> config option</li><li><strong>No auto-open</strong> - Removed intrusive auto-opening of warning log tab</li><li><strong>E2E tests</strong> - Tests for command existence and basic execution</li></ol><h3 id="plugin-api-✓" tabindex="-1">Plugin API ✓ <a class="header-anchor" href="#plugin-api-✓" aria-label="Permalink to &quot;Plugin API ✓&quot;">​</a></h3><p><strong>New Hooks (Core → Plugin):</strong></p><ol><li><code>LspServerError</code> - Emitted when LSP fails to start (language, server_command, error_type, message) ✓</li><li><code>LspStatusClicked</code> - Emitted when user clicks LSP indicator (language, has_error) ✓</li><li><code>ActionPopupResult</code> - Emitted when user selects action or dismisses popup (popup_id, action_id) ✓</li></ol><p><strong>New API functions (Plugin → Core):</strong></p><ol><li><code>editor.showActionPopup(options)</code> - Show popup with selectable action list ✓</li><li><code>editor.disableLspForLanguage(language)</code> - Disable LSP and persist to config ✓</li></ol><p><strong>Bundled plugins:</strong></p><ol><li><code>plugins/python-lsp.ts</code> - Python LSP helper (pip, pipx install commands) ✓</li><li><code>plugins/rust-lsp.ts</code> - Rust LSP helper (rustup, brew, cargo install commands) ✓</li><li><code>plugins/typescript-lsp.ts</code> - TypeScript/JavaScript LSP helper (npm, yarn, pnpm install commands) ✓</li></ol><h3 id="dropped" tabindex="-1">Dropped <a class="header-anchor" href="#dropped" aria-label="Permalink to &quot;Dropped&quot;">​</a></h3><ul><li>Initial appearance animation (unnecessary complexity)</li></ul><h2 id="references" tabindex="-1">References <a class="header-anchor" href="#references" aria-label="Permalink to &quot;References&quot;">​</a></h2><ul><li>GitHub Issue #493: How to suppress auto opening of warning file</li><li>GitHub Issue #451: Log file appeared (LSP error tab auto-opens)</li><li>NNGroup: 10 Usability Heuristics for User Interface Design</li></ul>`,88)])])}const c=i(l,[["render",p]]);export{g as __pageData,c as default};
