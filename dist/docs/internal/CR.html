<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Code Review | Fresh</title>
    <meta name="description" content="Fresh is a fast, modern terminal text editor with intuitive keybindings, syntax highlighting, and instant startup.">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/fresh/assets/style.BRX1cOS8.css" as="style">
    <link rel="preload stylesheet" href="/fresh/vp-icons.css" as="style">
    
    <script type="module" src="/fresh/assets/app.gWnVHcnC.js"></script>
    <link rel="preload" href="/fresh/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/fresh/assets/chunks/theme.7qGkjoxp.js">
    <link rel="modulepreload" href="/fresh/assets/chunks/framework.CffQSbY-.js">
    <link rel="modulepreload" href="/fresh/assets/internal_CR.md.CddFPN2F.lean.js">
    <link rel="icon" href="/fresh/favicon.ico">
    <script id="check-dark-mode">document.documentElement.classList.add("dark");</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/fresh/" data-v-1168a8e4><!--[--><!--]--><!--[--><!--[--><!--[--><img class="VPImage dark logo" src="/fresh/logo.svg" alt data-v-8426fc1a><!--]--><!--[--><img class="VPImage light logo" src="/fresh/logo.svg" alt data-v-8426fc1a><!--]--><!--]--><!--]--><span data-v-1168a8e4>Fresh</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/fresh/guide/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Guide</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/fresh/features/terminal" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Features</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/fresh/development/architecture" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Development</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://github.com/sinelaw/fresh/releases/latest" target="_blank" rel="noreferrer" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Download</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://github.com/sinelaw/fresh/issues" target="_blank" rel="noreferrer" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Issues & Requests</span><!--]--></a><!--]--><!--]--></nav><!----><!----><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/sinelaw/fresh" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><!----><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/sinelaw/fresh" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><!----><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/index" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Getting Started</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>User Guide</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Introduction</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/editing" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Editing & Navigation</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/terminal" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Terminal</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/lsp" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>LSP Integration</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/plugins" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Plugins</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/themes" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Themes</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/configuration" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Configuration</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/keyboard" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Keyboard Setup</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/i18n" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Internationalization</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/troubleshooting" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Troubleshooting</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/guide/keybindings" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Keybindings</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Features</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/features/terminal" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Terminal</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/features/vi-mode" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Vi Mode</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Development</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/development/architecture" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Architecture</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/development/plugin-api" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Plugin API</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/development/plugin-development" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Plugin Development</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Design Documents</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/design/config-editor" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Config Editor</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/design/paste-handling" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Paste Handling</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/design/scroll-sync" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Scroll Sync</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/design/unicode-width" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Unicode Width</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/design/visual-layout" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Visual Layout</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/design/i18n" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Internationalization</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/fresh/design/search-next-occurrence" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Search Next Occurrence</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _fresh_internal_CR" data-v-39a288b8><div><h1 id="code-review" tabindex="-1">Code Review <a class="header-anchor" href="#code-review" aria-label="Permalink to &quot;Code Review&quot;">​</a></h1><p>Pending code quality improvements and refactoring opportunities.</p><p>Note: file/line references are best-effort and can drift as the code changes; treat line numbers as approximate.</p><h2 id="large-functions" tabindex="-1">Large Functions <a class="header-anchor" href="#large-functions" aria-label="Permalink to &quot;Large Functions&quot;">​</a></h2><ul><li>src/app/render.rs:5 — top-level <code>render</code> runs ~450 lines covering layout calculation, plugin hook firing, file explorer rendering, and status/prompt UI. The amount of responsibility in one function hurts readability and testing; factoring into helpers (layout, plugin hook prep, explorer rendering, status/prompt rendering) would make regressions easier to spot.</li><li>src/input/keybindings.rs:376 — <code>Action::from_str</code> is a ~260-line string-to-enum match. A data-driven table would reduce boilerplate and avoid missing new actions when added to the enum.</li><li>src/input/commands.rs:89 — <code>get_all_commands</code> is a ~540-line literal list in one function. This is brittle to maintain (hard to diff/review additions) and couples command metadata to code; consider a data table or config-driven source with tests for completeness.</li><li>src/primitives/highlighter.rs:78 — <code>highlight_config</code> is ~450 lines of repetitive per-language setup; moving to a data table (language -&gt; queries/config) would reduce duplication and make it harder to forget highlight names when adding languages.</li><li>src/config.rs:566 — <code>default_menus</code> is a 420-line literal definition. Consider moving menu data to structured config or a table to make changes easier to diff/test and to avoid bloating code with data.</li><li>src/view/viewport.rs:521 — <code>ensure_visible</code> runs ~230 lines of layout math and clamping in one method; breaking into smaller helpers (e.g., horizontal/vertical logic, scroll computations) would make correctness checks and future changes safer.</li><li>src/input/keybindings.rs:1196 — <code>format_action</code> spans ~200 lines mirroring <code>from_str</code>; another sign a data-driven action registry would reduce duplication and risk of drift.</li><li>src/view/ui/view_pipeline.rs:134 — <code>next</code> is a 160+ line iterator step that handles multiple line types and wrapping; decomposing per-case helpers would make it easier to verify wrapping and newline behaviors.</li><li>src/model/buffer.rs:575 — <code>get_text_range_mut</code> is a 160+ line method with intertwined chunk handling, file streaming, and cache management. The dense control flow increases the risk of off-by-one or range bugs; extract helpers per buffer variant (loaded vs unloaded) and centralize bounds checks.</li><li>src/services/plugins/runtime.rs:1861/1967/2066/2143/2159/etc. — repeated <code>pending_responses.lock().unwrap()</code> (and other mutex <code>unwrap()</code>s) in ops will panic if the mutex is poisoned by a plugin panic. These should handle poisoning and return an error to the plugin rather than crashing the runtime.</li><li>src/view/ui/file_explorer.rs:148 — renderer calls <code>view.tree().get_node(node_id).expect(&quot;Node should exist&quot;)</code>. A desynced tree (e.g., after FS errors or refresh races) will panic the UI; prefer graceful fallback or placeholder row.</li><li>src/view/file_tree/tree.rs:138 — <code>expand_node</code> uses <code>self.get_node(id).unwrap()</code> while doing async FS reads. If the node was removed between calls, this panics instead of returning an IO error; return a proper error for missing nodes to avoid crashing the explorer.</li><li>src/view/ui/status_bar.rs:149 — <code>render_status</code> pulls cursor info with ad-hoc line iteration and cached line numbers in a long method; consider extracting helpers for cursor position and diagnostics summary to reduce the ~200-line render method complexity.</li><li>src/model/cursor.rs:220 — <code>primary()</code>/<code>primary_mut()</code> use <code>expect(&quot;Primary cursor should always exist&quot;)</code>. If a bug ever removes the primary cursor (e.g., during multi-cursor deletion), the editor will panic. Prefer returning an error or recreating a primary cursor to keep the UI alive.</li><li>src/model/marker_tree.rs:494/509/512/517/etc. — AVL rotations and queries use unchecked <code>unwrap()</code> on child pointers. Any tree corruption (e.g., from earlier logic bugs) will panic. Consider defensive checks or debug assertions gated for release builds to avoid crashing the editor.</li><li>src/view/split.rs:162 — <code>ensure_layout</code> returns <code>self.layout.as_ref().unwrap()</code>. If callers forget to call <code>ensure_layout</code> before <code>get_layout</code> usage, rendering will panic. Consider returning <code>Option&lt;&amp;Layout&gt;</code> or asserting via a Result to make misuse harder in production.</li><li>src/view/ui/split_rendering.rs:1642/1838 — rendering paths <code>unwrap()</code> optional highlight colors/positions when overlays and syntax spans overlap. If the lookups ever return <code>None</code> (e.g., missing semantic span), the renderer will panic; handle <code>None</code> with defaults to keep the UI resilient.</li><li>src/view/prompt.rs:974 — <code>selected_text().unwrap()</code> in selection paths; production prompt operations should avoid panics when no selection exists (e.g., racey UI updates or plugin-driven prompt changes).</li><li>src/input/buffer_mode.rs: ModeRegistry and BufferMode rely on string names without validation; missing mode references during inheritance or resolve silently stop traversal, which can mask misconfigurations. Consider explicit errors/logging for unknown parent/mode to aid debugging.</li><li>src/view/viewport.rs:895 — <code>ensure_cursors_visible</code> unwraps min/max cursor positions; if called with an empty cursor list (due to upstream logic bugs), it will panic. Guard against empty input to keep scrolling resilient.</li><li>src/view/ui/suggestions.rs:80/87 — width calculations use <code>.max().unwrap_or(0)</code> on suggestion lists; if any suggestion text/keybinding is extremely wide, width computation and rendering alignment are packed into the main render function. Consider extracting layout calculation and handling unreasonably wide strings to avoid overflow/panic in rendering math.</li><li>src/services/signal_handler.rs:23/104 — global backtrace storage uses <code>Mutex::lock().unwrap()</code>; any poisoning (e.g., panic during signal handling) will panic again. Signal handlers should avoid unwraps and degrade gracefully to prevent double panics during shutdown.</li><li>src/services/async_bridge.rs:300/324/329/356/... — multiple <code>unwrap()</code>s on channel send/recv in the bridge; if the channel is closed (e.g., runtime shutdown), the bridge will panic instead of allowing a clean exit. Return errors and let the main loop terminate gracefully.</li><li>src/services/process_limits.rs:405/406/459/476/496/503 — heavy use of <code>unwrap()</code> around serialization and system resource reads; a failure to read system memory or serialize limits will panic instead of bubbling a configuration error. Prefer error propagation.</li><li>src/services/plugins/api.rs &amp; event_hooks/process: widespread <code>RwLock::unwrap()</code> and channel <code>unwrap()</code>s. A poisoned lock or closed channel will panic plugins and potentially the editor. Replace with error paths that surface to the plugin caller or log-and-drop to keep the host stable.</li><li>src/input/command_registry.rs — plugin command registration/history uses <code>RwLock::unwrap()</code> in production paths; a poisoned lock (plugin panic) will crash the editor. Handle lock errors and surface failures to plugins.</li><li>src/input/actions.rs:68 — block selection reads <code>cursor.block_anchor.unwrap()</code> when in block mode; if state enters block mode without an anchor, movement will panic. Guard against None to keep editing stable.</li><li>src/services/plugins/process.rs:132/166/195/226 — plugin process bridge uses <code>recv().unwrap()</code>; closed channels during shutdown will panic the host. Treat channel closure as cancellation to allow clean teardown.</li><li>src/services/plugins/process.rs — blocking <code>recv()</code> loops have no timeout/backoff; a misbehaving plugin can hang the thread. Consider async or timeout-aware handling to avoid host hangs.</li><li>src/services/async_bridge.rs — uses unbounded std::sync::mpsc channels with no backpressure or eviction; a burst of async messages (e.g., LSP floods) can grow memory unbounded. Consider bounded channels or dropping strategies plus explicit error propagation on lock/channel failure.</li><li>src/services/plugins/event_hooks.rs — <code>apply_event_with_hooks</code> appears to be legacy/test-only and is not part of the current editor edit path (which applies edits via <code>Editor::apply_event_to_active_buffer</code> and queues plugin hooks asynchronously). If this module becomes production-critical again, it should isolate hook execution (catch_unwind/log) and avoid panics on poisoned locks.</li><li>src/app/plugin_commands.rs — some plugin text-editing commands (<code>InsertText</code>, <code>DeleteRange</code>, <code>InsertAtCursor</code>) mutate buffers without going through <code>Editor::apply_event_to_active_buffer</code>, which can bypass cross-cutting concerns (LSP change notifications, search highlight clearing, cursor/view sync, plugin after-insert/delete hooks). Consider routing “real edit” plugin commands through the centralized apply path, or document them as “raw/unsafe” edits.</li><li>src/view/ui/tabs.rs — <code>render_for_split</code> packs tab width calculation, scroll computation, and rendering into one long function; consider splitting into layout calculation and render steps to improve readability and reduce bugs in scroll math.</li><li>src/services/process_limits.rs — applies limits via cgroups/setrlimit with many unwraps noted; also lacks clear fallback/reporting when limits can&#39;t be applied (e.g., non-Linux or missing cgroup perms). Return actionable errors so callers can decide to continue without limits.</li></ul><h2 id="test-code" tabindex="-1">Test Code <a class="header-anchor" href="#test-code" aria-label="Permalink to &quot;Test Code&quot;">​</a></h2><ul><li>src/view/ui/menu.rs:655/776/811/830 — menu parsing/rendering tests use <code>unwrap()</code>; production parsing should handle malformed plugin menu contributions gracefully.</li><li>src/services/fs/slow.rs — tests use <code>TempDir::new().unwrap()</code>/<code>read_dir().await</code> unwraps; ensure production slow backend surfaces IO errors cleanly.</li><li>src/view/popup.rs — selection tests <code>unwrap()</code> the selected item; production popup handling should guard empty lists.</li></ul></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><div class="edit-info" data-v-e257564d><div class="edit-link" data-v-e257564d><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/sinelaw/fresh/edit/master/docs/internal/CR.md" target="_blank" rel="noreferrer" data-v-e257564d><!--[--><span class="vpi-square-pen edit-link-icon" data-v-e257564d></span> Edit this page<!--]--></a></div><div class="last-updated" data-v-e257564d><p class="VPLastUpdated" data-v-e257564d data-v-e98dd255>Last updated: <time datetime="2025-12-18T12:21:30.000Z" data-v-e98dd255></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><!----></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/fresh/index" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>Getting Started</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5d98c3a5 data-v-e315a0ad><div class="container" data-v-e315a0ad><p class="message" data-v-e315a0ad>Released under the Apache 2.0 License</p><!----></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"design_config-editor.md\":\"DHGjzCxf\",\"design_i18n.md\":\"XST-buo6\",\"design_paste-handling.md\":\"BoGHj9tm\",\"design_scroll-sync.md\":\"5y7aEty5\",\"design_search-next-occurrence.md\":\"eH349-M3\",\"design_unicode-width.md\":\"DXXzrMtJ\",\"design_visual-layout.md\":\"CR2Yf-UK\",\"development_architecture.md\":\"C0z0erNC\",\"development_plugin-api.md\":\"02Zf_uWD\",\"development_plugin-development.md\":\"DDVOsukg\",\"features_terminal.md\":\"DXQyMBXY\",\"features_vi-mode.md\":\"DxOi2haG\",\"guide_configuration.md\":\"DKSUV7wf\",\"guide_editing.md\":\"qgrD9jGh\",\"guide_i18n.md\":\"BQuZvWbg\",\"guide_index.md\":\"CNsD-Eyr\",\"guide_keybindings.md\":\"lQgq3MNO\",\"guide_keyboard.md\":\"LxmlLjdz\",\"guide_lsp.md\":\"DPCnEwA7\",\"guide_plugins.md\":\"BQZA9F_p\",\"guide_terminal.md\":\"CEp4n3DC\",\"guide_themes.md\":\"CexLbvsP\",\"guide_troubleshooting.md\":\"qMYBY5ed\",\"index.md\":\"4kX30mfe\",\"internal_bulk-edit-optimization.md\":\"BMxCHJDA\",\"internal_config_design.md\":\"Dl6dywEy\",\"internal_config_implementation_plan.md\":\"nGKfbTil\",\"internal_cr.md\":\"CddFPN2F\",\"internal_diff_view.md\":\"C7ID9-Nc\",\"internal_input_calibration_wizard.md\":\"MB1ejh_K\",\"internal_markdown.md\":\"B2IwUkFR\",\"internal_readme.md\":\"DLpZaH-e\",\"internal_theme-usability-improvements.md\":\"C1sTTe52\",\"internal_theme-user-flows.md\":\"DT0SwUX6\",\"internal_timesource_design.md\":\"Cte2Jzc2\",\"internal_warning_notification_ux.md\":\"CG_GzLqf\",\"visual-regression_tests_comprehensive_ui_a.md\":\"D02B_xcU\",\"visual-regression_tests_comprehensive_ui_b.md\":\"q7gT-nbA\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Fresh\",\"description\":\"Fresh is a fast, modern terminal text editor with intuitive keybindings, syntax highlighting, and instant startup.\",\"base\":\"/fresh/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":\"force-dark\",\"themeConfig\":{\"logo\":{\"light\":\"/logo.svg\",\"dark\":\"/logo.svg\"},\"nav\":[{\"text\":\"Guide\",\"link\":\"/guide/\"},{\"text\":\"Features\",\"link\":\"/features/terminal\"},{\"text\":\"Development\",\"link\":\"/development/architecture\"},{\"text\":\"Download\",\"link\":\"https://github.com/sinelaw/fresh/releases/latest\"},{\"text\":\"Issues & Requests\",\"link\":\"https://github.com/sinelaw/fresh/issues\"}],\"sidebar\":[{\"items\":[{\"text\":\"Getting Started\",\"link\":\"/index\"}]},{\"text\":\"User Guide\",\"collapsed\":false,\"items\":[{\"text\":\"Introduction\",\"link\":\"/guide/\"},{\"text\":\"Editing & Navigation\",\"link\":\"/guide/editing\"},{\"text\":\"Terminal\",\"link\":\"/guide/terminal\"},{\"text\":\"LSP Integration\",\"link\":\"/guide/lsp\"},{\"text\":\"Plugins\",\"link\":\"/guide/plugins\"},{\"text\":\"Themes\",\"link\":\"/guide/themes\"},{\"text\":\"Configuration\",\"link\":\"/guide/configuration\"},{\"text\":\"Keyboard Setup\",\"link\":\"/guide/keyboard\"},{\"text\":\"Internationalization\",\"link\":\"/guide/i18n\"},{\"text\":\"Troubleshooting\",\"link\":\"/guide/troubleshooting\"},{\"text\":\"Keybindings\",\"link\":\"/guide/keybindings\"}]},{\"text\":\"Features\",\"collapsed\":false,\"items\":[{\"text\":\"Terminal\",\"link\":\"/features/terminal\"},{\"text\":\"Vi Mode\",\"link\":\"/features/vi-mode\"}]},{\"text\":\"Development\",\"collapsed\":false,\"items\":[{\"text\":\"Architecture\",\"link\":\"/development/architecture\"},{\"text\":\"Plugin API\",\"link\":\"/development/plugin-api\"},{\"text\":\"Plugin Development\",\"link\":\"/development/plugin-development\"}]},{\"text\":\"Design Documents\",\"collapsed\":true,\"items\":[{\"text\":\"Config Editor\",\"link\":\"/design/config-editor\"},{\"text\":\"Paste Handling\",\"link\":\"/design/paste-handling\"},{\"text\":\"Scroll Sync\",\"link\":\"/design/scroll-sync\"},{\"text\":\"Unicode Width\",\"link\":\"/design/unicode-width\"},{\"text\":\"Visual Layout\",\"link\":\"/design/visual-layout\"},{\"text\":\"Internationalization\",\"link\":\"/design/i18n\"},{\"text\":\"Search Next Occurrence\",\"link\":\"/design/search-next-occurrence\"}]}],\"outline\":{\"level\":\"deep\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/sinelaw/fresh\"}],\"search\":{\"provider\":\"local\"},\"editLink\":{\"pattern\":\"https://github.com/sinelaw/fresh/edit/master/docs/:path\"},\"footer\":{\"message\":\"Released under the Apache 2.0 License\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>